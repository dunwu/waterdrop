import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as e}from"./app-DM5IpGMv.js";const l={};function t(h,s){return e(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="ç‰ˆæœ¬ç®¡ç†ä¸­é—´ä»¶-flyway" tabindex="-1"><a class="header-anchor" href="#ç‰ˆæœ¬ç®¡ç†ä¸­é—´ä»¶-flyway"><span>ç‰ˆæœ¬ç®¡ç†ä¸­é—´ä»¶ Flyway</span></a></h1><blockquote><p>Flyway æ˜¯ä¸€ä¸ªæ•°æ®è¿ç§»å·¥å…·ã€‚</p></blockquote><h2 id="ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹"><span>ç®€ä»‹</span></a></h2><h3 id="ä»€ä¹ˆæ˜¯-flyway" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-flyway"><span>ä»€ä¹ˆæ˜¯ Flyway</span></a></h3><p><strong>Flyway æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®åº“è¿ç§»å·¥å…·ã€‚</strong></p><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®è¿ç§»" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®è¿ç§»"><span>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®è¿ç§»</span></a></h3><p>åœ¨ä»£ç ä¾§ï¼ˆå³åº”ç”¨è½¯ä»¶ï¼‰çš„ç‰ˆæœ¬é—®é¢˜æ¯”è¾ƒå®¹æ˜“è§£å†³ï¼š</p><ul><li>æœ‰æ–¹ä¾¿çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·</li><li>æœ‰å¯å¤ç”¨çš„æ„å»ºå’ŒæŒç»­é›†æˆ</li><li>è§„èŒƒçš„å‘å¸ƒå’Œéƒ¨ç½²è¿‡ç¨‹</li></ul><p>é‚£ä¹ˆï¼Œæ•°æ®åº“å±‚é¢çš„ç‰ˆæœ¬é—®é¢˜å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p><p>ç›®å‰ä»ç„¶æ²¡æœ‰æ–¹ä¾¿çš„æ•°æ®åº“ç‰ˆæœ¬å·¥å…·ã€‚è®¸å¤šé¡¹ç›®ä»ä½¿ç”¨ sql è„šæœ¬æ¥è§£å†³ç‰ˆæœ¬å†²çªï¼Œç”šè‡³æ˜¯é‡åˆ°å†²çªé—®é¢˜æ—¶æ‰æƒ³èµ·ç”¨ sql è¯­å¥å»è§£å†³ã€‚</p><p>ç”±æ­¤ï¼Œå¼•å‘ä¸€äº›é—®é¢˜ï¼š</p><ul><li>æœºå™¨ä¸Šçš„æ•°æ®åº“æ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Ÿ</li><li>è„šæœ¬åˆ°åº•ç”Ÿæ•ˆæ²¡æœ‰ï¼Ÿ</li><li>ç”Ÿäº§ç¯å¢ƒä¿®å¤çš„é—®é¢˜æ˜¯å¦ä¹Ÿåœ¨æµ‹è¯•ç¯å¢ƒä¿®å¤äº†ï¼Ÿ</li><li>å¦‚ä½•å»ºç«‹ä¸€ä¸ªæ–°çš„æ•°æ®åº“å®ä¾‹ï¼Ÿ</li></ul><p>æ•°æ®è¿ç§»å°±æ˜¯ç”¨æ¥æå®šè¿™äº›æ··ä¹±çš„é—®é¢˜ï¼š</p><ul><li>é€šè¿‡è‰ç¨¿é‡å»ºä¸€ä¸ªæ•°æ®åº“ã€‚</li><li>åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥æ¸…æ¥šçš„äº†è§£æ•°æ®åº“çš„çŠ¶æ€ã€‚</li><li>ä»¥ä¸€ç§æ˜ç¡®çš„æ–¹å¼å°†æ•°æ®åº“ä»å½“å‰ç‰ˆæœ¬è¿ç§»åˆ°ä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚</li></ul><h3 id="flyway-å¦‚ä½•å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#flyway-å¦‚ä½•å·¥ä½œ"><span>Flyway å¦‚ä½•å·¥ä½œï¼Ÿ</span></a></h3><p>æœ€ç®€å•çš„åœºæ™¯æ˜¯æŒ‡å®š Flyway è¿ç§»åˆ°ä¸€ä¸ªç©ºçš„æ•°æ®åº“ã€‚</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/archive/2026/02/9baea6f7af01432ab3d12e54f3e0f90a.webp" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Flyway ä¼šå°è¯•æŸ¥æ‰¾å®ƒçš„ schema å†å²è¡¨ï¼Œå¦‚æœæ•°æ®åº“æ˜¯ç©ºçš„ï¼ŒFlyway å°±ä¸å†æŸ¥æ‰¾ï¼Œè€Œæ˜¯ç›´æ¥åˆ›å»ºæ•°æ®åº“ã€‚</p><p>ç°å†ä½ å°±æœ‰äº†ä¸€ä¸ªä»…åŒ…å«ä¸€å¼ ç©ºè¡¨çš„æ•°æ®åº“ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™å¼ è¡¨å« <strong>flyway_schema_history</strong>ã€‚</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/archive/2026/02/22d3e352485c4241abc15d89608a7094.webp" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>è¿™å¼ è¡¨å°†è¢«ç”¨äºè¿½è¸ªæ•°æ®åº“çš„çŠ¶æ€ã€‚</p><p>ç„¶åï¼ŒFlyway å°†å¼€å§‹æ‰«ææ–‡ä»¶ç³»ç»Ÿæˆ–åº”ç”¨ classpath ä¸­çš„ <strong>migrations</strong>ã€‚è¿™äº› <strong>migrations</strong> å¯ä»¥æ˜¯ sql æˆ– javaã€‚</p><p>è¿™äº› <strong>migrations</strong> å°†æ ¹æ®ä»–ä»¬çš„ç‰ˆæœ¬å·è¿›è¡Œæ’åºã€‚</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/archive/2026/02/8ee2f02c5ae4471fbbc965ae0999ae2b.webp" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä»»æ„ migration åº”ç”¨åï¼Œschema å†å²è¡¨å°†æ›´æ–°ã€‚å½“å…ƒæ•°æ®å’Œåˆå§‹çŠ¶æ€æ›¿æ¢åï¼Œå¯ä»¥ç§°ä¹‹ä¸ºï¼šè¿ç§»åˆ°æ–°ç‰ˆæœ¬ã€‚</p><p>Flyway ä¸€æ—¦æ‰«æäº†æ–‡ä»¶ç³»ç»Ÿæˆ–åº”ç”¨ classpath ä¸‹çš„ migrationsï¼Œè¿™äº› migrations ä¼šæ£€æŸ¥ schema å†å²è¡¨ã€‚å¦‚æœå®ƒä»¬çš„ç‰ˆæœ¬å·ä½äºæˆ–ç­‰äºå½“å‰çš„ç‰ˆæœ¬ï¼Œå°†è¢«å¿½ç•¥ã€‚ä¿ç•™ä¸‹æ¥çš„ migrations æ˜¯ç­‰å¾…çš„ migrationsï¼Œæœ‰æ•ˆä½†æ²¡æœ‰åº”ç”¨ã€‚</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/archive/2026/02/e5e96d8528b1485e9f9eddfe15290818.webp" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>migrations å°†æ ¹æ®ç‰ˆæœ¬å·æ’åºå¹¶æŒ‰åºæ‰§è¡Œã€‚</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/archive/2026/02/da9d8ff9fcc9404491105c0b2b4ce3d8.webp" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="å¿«é€Ÿä¸Šæ‰‹" tabindex="-1"><a class="header-anchor" href="#å¿«é€Ÿä¸Šæ‰‹"><span>å¿«é€Ÿä¸Šæ‰‹</span></a></h2><p>Flyway æœ‰ 4 ç§ä½¿ç”¨æ–¹å¼ï¼š</p><ul><li>å‘½ä»¤è¡Œ</li><li>JAVA API</li><li>Maven</li><li>Gradle</li></ul><h3 id="å‘½ä»¤è¡Œ" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤è¡Œ"><span>å‘½ä»¤è¡Œ</span></a></h3><p>é€‚ç”¨äºé Java ç”¨æˆ·ï¼Œæ— éœ€æ„å»ºã€‚</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; flyway migrate </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">-url</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">...</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> -user</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">...</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> -password</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ï¼ˆ1ï¼‰<strong>ä¸‹è½½è§£å‹</strong></p><p>è¿›å…¥<a href="https://flywaydb.org/download/" target="_blank" rel="noopener noreferrer">å®˜æ–¹ä¸‹è½½é¡µé¢</a>ï¼Œé€‰æ‹©åˆé€‚ç‰ˆæœ¬ï¼Œä¸‹è½½å¹¶è§£å‹åˆ°æœ¬åœ°ã€‚</p><p>ï¼ˆ2ï¼‰<strong>é…ç½® flyway</strong></p><p>ç¼–è¾‘ <code>/conf/flyway.conf</code>ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-properties"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">flyway.url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">jdbc:h2:file:./foobardb</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">flyway.user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">SA</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">flyway.password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆ3ï¼‰<strong>åˆ›å»ºç¬¬ä¸€ä¸ª migration</strong></p><p>åœ¨ <code>/sql</code> ç›®å½•ä¸‹åˆ›å»º <code>V1__Create_person_table.sql</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> PERSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ID </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> not null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    NAME</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">not null</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆ4ï¼‰<strong>è¿ç§»æ•°æ®åº“</strong></p><p>è¿è¡Œ Flyway æ¥è¿ç§»æ•°æ®åº“ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">flyway-5.1.4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">flyway</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> migrate</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿è¡Œæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Database: jdbc:h2:file:./foobardb (H2 1.4)</span></span>
<span class="line"><span>Successfully validated 1 migration (execution time 00:00.008s)</span></span>
<span class="line"><span>Creating Schema History table: &quot;PUBLIC&quot;.&quot;flyway_schema_history&quot;</span></span>
<span class="line"><span>Current version of schema &quot;PUBLIC&quot;: &lt;&lt; Empty Schema &gt;&gt;</span></span>
<span class="line"><span>Migrating schema &quot;PUBLIC&quot; to version 1 - Create person table</span></span>
<span class="line"><span>Successfully applied 1 migration to schema &quot;PUBLIC&quot; (execution time 00:00.033s)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆ5ï¼‰<strong>æ·»åŠ ç¬¬äºŒä¸ª migration</strong></p><p>åœ¨ <code>/sql</code> ç›®å½•ä¸‹åˆ›å»º <code>V2__Add_people.sql</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">insert into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PERSON (ID, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">values</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Axel&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">insert into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PERSON (ID, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">values</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Mr. Foo&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">insert into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PERSON (ID, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">values</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Ms. Bar&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œ Flyway</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">flyway-5.1.4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">flyway</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> migrate</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿è¡Œæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Database: jdbc:h2:file:./foobardb (H2 1.4)</span></span>
<span class="line"><span>Successfully validated 2 migrations (execution time 00:00.018s)</span></span>
<span class="line"><span>Current version of schema &quot;PUBLIC&quot;: 1</span></span>
<span class="line"><span>Migrating schema &quot;PUBLIC&quot; to version 2 - Add people</span></span>
<span class="line"><span>Successfully applied 1 migration to schema &quot;PUBLIC&quot; (execution time 00:00.016s)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="java-api" tabindex="-1"><a class="header-anchor" href="#java-api"><span>JAVA API</span></a></h3><p>ï¼ˆ1ï¼‰<strong>å‡†å¤‡</strong></p><ul><li>Java8+</li><li>Maven 3.x</li></ul><p>ï¼ˆ2ï¼‰<strong>æ·»åŠ ä¾èµ–</strong></p><p>åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-xml"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">project</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ...&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependencies</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.flywaydb&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;flyway-core&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;5.1.4&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;com.h2database&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;h2&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;1.3.170&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependencies</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">project</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆ3ï¼‰<strong>é›†æˆ Flyway</strong></p><p>æ·»åŠ  <code>App.java</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.flywaydb.core.Flyway</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> App</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Create the Flyway instance</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Flyway</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> flyway</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Flyway</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Point it to the database</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        flyway</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setDataSource</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;jdbc:h2:file:./target/foobar&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;sa&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Start the migration</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        flyway</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">migrate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆ4ï¼‰<strong>åˆ›å»ºç¬¬ä¸€ä¸ª migration</strong></p><p>æ·»åŠ  <code>src/main/resources/db/migration/V1__Create_person_table.sql</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> PERSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ID </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> not null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    NAME</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">not null</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆ5ï¼‰<strong>æ‰§è¡Œç¨‹åº</strong></p><p>æ‰§è¡Œ <code>App#main</code>ï¼š</p><p>è¿è¡Œæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>INFO: Creating schema history table: &quot;PUBLIC&quot;.&quot;flyway_schema_history&quot;</span></span>
<span class="line"><span>INFO: Current version of schema &quot;PUBLIC&quot;: &lt;&lt; Empty Schema &gt;&gt;</span></span>
<span class="line"><span>INFO: Migrating schema &quot;PUBLIC&quot; to version 1 - Create person table</span></span>
<span class="line"><span>INFO: Successfully applied 1 migration to schema &quot;PUBLIC&quot; (execution time 00:00.062s).</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆ6ï¼‰<strong>æ·»åŠ ç¬¬äºŒä¸ª migration</strong></p><p>æ·»åŠ  src/main/resources/db/migration/V2__Add_people.sql æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">insert into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PERSON (ID, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">values</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Axel&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">insert into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PERSON (ID, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">values</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Mr. Foo&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">insert into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> PERSON (ID, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">values</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Ms. Bar&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>INFO: Current version of schema &quot;PUBLIC&quot;: 1</span></span>
<span class="line"><span>INFO: Migrating schema &quot;PUBLIC&quot; to version 2 - Add people</span></span>
<span class="line"><span>INFO: Successfully applied 1 migration to schema &quot;PUBLIC&quot; (execution time 00:00.090s).</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="maven" tabindex="-1"><a class="header-anchor" href="#maven"><span>Maven</span></a></h3><p>ä¸ Java API æ–¹å¼å¤§ä½“ç›¸åŒï¼ŒåŒºåˆ«åœ¨ <strong>é›†æˆ Flyway</strong> æ­¥éª¤ï¼š</p><p>Maven æ–¹å¼ä½¿ç”¨æ’ä»¶æ¥é›†æˆ Flywayï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-xml"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">project</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> xmlns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;...&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">plugin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.flywaydb&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;flyway-maven-plugin&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;5.1.4&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">configuration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;jdbc:h2:file:./target/foobar&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;sa&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">configuration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependencies</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;com.h2database&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;h2&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;1.4.191&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependencies</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">plugin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">project</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºç”¨çš„æ˜¯æ’ä»¶ï¼Œæ‰€ä»¥æ‰§è¡Œæ–¹å¼ä¸å†æ˜¯è¿è¡Œ Java ç±»ï¼Œè€Œæ˜¯æ‰§è¡Œ maven æ’ä»¶ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; mvn flyway:migrate</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>ğŸ‘‰ å‚è€ƒï¼š<a href="https://github.com/dunwu/Database/tree/master/codes/middleware/flyway" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹æºç </a></p></blockquote><h3 id="gradle" tabindex="-1"><a class="header-anchor" href="#gradle"><span>Gradle</span></a></h3><p>æœ¬äººä¸ç”¨ Gradleï¼Œç•¥ã€‚</p><h2 id="å…¥é—¨ç¯‡" tabindex="-1"><a class="header-anchor" href="#å…¥é—¨ç¯‡"><span>å…¥é—¨ç¯‡</span></a></h2><h3 id="æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#æ¦‚å¿µ"><span>æ¦‚å¿µ</span></a></h3><h4 id="migrations" tabindex="-1"><a class="header-anchor" href="#migrations"><span>Migrations</span></a></h4><p>åœ¨ Flyway ä¸­ï¼Œå¯¹äºæ•°æ®åº“çš„ä»»ä½•æ”¹å˜éƒ½ç§°ä¹‹ä¸º <strong>Migrations</strong>ã€‚</p><p>Migrations å¯ä»¥åˆ†ä¸º Versioned migrations å’Œ Repeatable migrationsã€‚</p><p>Versioned migrations æœ‰ 2 ç§å½¢å¼ï¼šregular å’Œ undoã€‚</p><p>Versioned migrations å’Œ Repeatable migrations éƒ½å¯ä»¥ä½¿ç”¨ SQL æˆ– JAVA æ¥ç¼–å†™ã€‚</p><h5 id="versioned-migrations" tabindex="-1"><a class="header-anchor" href="#versioned-migrations"><span>Versioned migrations</span></a></h5><p>ç”±ä¸€ä¸ªç‰ˆæœ¬å·ï¼ˆversionï¼‰ã€ä¸€æ®µæè¿°ï¼ˆdescriptionï¼‰ã€ä¸€ä¸ªæ ¡éªŒï¼ˆchecksumï¼‰ç»„æˆã€‚ç‰ˆæœ¬å·å¿…é¡»æ˜¯æƒŸä¸€çš„ã€‚Versioned migrations åªèƒ½æŒ‰é¡ºåºæ‰§è¡Œä¸€æ¬¡ã€‚</p><p>ä¸€èˆ¬ç”¨äºï¼š</p><ul><li>å¢åˆ æ”¹ tables/indexes/foreign keys/enums/UDTsã€‚</li><li>å¼•ç”¨æ•°æ®æ›´æ–°</li><li>ç”¨æˆ·æ•°æ®æ ¡æ­£</li></ul><p>Regular ç¤ºä¾‹ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> car</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    license_plate </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VARCHAR</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    color </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VARCHAR</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> owner</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ADD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> driver_license_id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> brand (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;DeLorean&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="undo-migrations" tabindex="-1"><a class="header-anchor" href="#undo-migrations"><span>Undo migrations</span></a></h5><blockquote><p>æ³¨ï¼šä»…ä¸“ä¸šç‰ˆæ”¯æŒ</p></blockquote><p>Undo Versioned Migrations è´Ÿè´£æ’¤é”€ Regular Versioned migrations çš„å½±å“ã€‚</p><p>Undo ç¤ºä¾‹ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DELETE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> brand </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;DeLorean&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> owner</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DROP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> driver_license_id;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> car;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="repeatable-migrations" tabindex="-1"><a class="header-anchor" href="#repeatable-migrations"><span>Repeatable migrations</span></a></h5><p>ç”±ä¸€æ®µæè¿°ï¼ˆdescriptionï¼‰ã€ä¸€ä¸ªæ ¡éªŒï¼ˆchecksumï¼‰ç»„æˆã€‚Versioned migrations æ¯æ¬¡æ‰§è¡Œåï¼Œæ ¡éªŒï¼ˆchecksumï¼‰ä¼šæ›´æ–°ã€‚</p><p>Repeatable migrations ç”¨äºç®¡ç†å¯ä»¥é€šè¿‡ä¸€ä¸ªæ–‡ä»¶æ¥ç»´æŠ¤ç‰ˆæœ¬æ§åˆ¶çš„æ•°æ®åº“å¯¹è±¡ã€‚</p><p>ä¸€èˆ¬ç”¨äºï¼š</p><ul><li>åˆ›å»ºï¼ˆé‡å»ºï¼‰views/procedures/functions/packages ç­‰ã€‚</li><li>å¤§é‡å¼•ç”¨æ•°æ®é‡æ–°æ’å…¥</li></ul><p>ç¤ºä¾‹ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE OR REPLACE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> VIEW</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> blue_cars</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AS</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id, license_plate </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> cars </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> color</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;blue&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="åŸºäº-sql-çš„-migrations" tabindex="-1"><a class="header-anchor" href="#åŸºäº-sql-çš„-migrations"><span>åŸºäº SQL çš„ migrations</span></a></h5><p>migrations æœ€å¸¸ç”¨çš„ç¼–å†™å½¢å¼å°±æ˜¯ SQLã€‚</p><p>åŸºäº SQL çš„ migrations ä¸€èˆ¬ç”¨äºï¼š</p><ul><li>DDL å˜æ›´ï¼ˆé’ˆå¯¹ TABLES,VIEWS,TRIGGERS,SEQUENCES ç­‰çš„ CREATE/ALTER/DROP æ“ä½œï¼‰</li><li>ç®€å•çš„å¼•ç”¨æ•°æ®å˜æ›´ï¼ˆå¼•ç”¨æ•°æ®è¡¨ä¸­çš„ CRUDï¼‰</li><li>ç®€å•çš„å¤§é‡æ•°æ®å˜æ›´ï¼ˆå¸¸è§„æ•°æ®è¡¨ä¸­çš„ CRUDï¼‰</li></ul><p><strong>å‘½åè§„åˆ™</strong></p><p>ä¸ºäº†è¢« Flyway è‡ªåŠ¨è¯†åˆ«ï¼ŒSQL migrations çš„æ–‡ä»¶å‘½åå¿…é¡»éµå¾ªè§„å®šçš„æ¨¡å¼ï¼š</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/database/flyway/sql-migrations.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><strong>Prefix</strong> - <code>V</code> ä»£è¡¨ versioned migrations (å¯é…ç½®), <code>U</code> ä»£è¡¨ undo migrations (å¯é…ç½®)ã€ <code>R</code> ä»£è¡¨ repeatable migrations (å¯é…ç½®)</li><li><strong>Version</strong> - ç‰ˆæœ¬å·é€šè¿‡<code>.</code>(ç‚¹)æˆ–<code>_</code>(ä¸‹åˆ’çº¿)åˆ†éš” (repeatable migrations ä¸éœ€è¦)</li><li><strong>Separator</strong> - <code>__</code> (ä¸¤ä¸ªä¸‹åˆ’çº¿) (å¯é…ç½®)</li><li><strong>Description</strong> - ä¸‹åˆ’çº¿æˆ–ç©ºæ ¼åˆ†éš”çš„å•è¯</li><li><strong>Suffix</strong> - <code>.sql</code> (å¯é…ç½®)</li></ul><h5 id="åŸºäº-java-çš„-migrations" tabindex="-1"><a class="header-anchor" href="#åŸºäº-java-çš„-migrations"><span>åŸºäº JAVA çš„ migrations</span></a></h5><p>åŸºäº JAVA çš„ migrations é€‚ç”¨äºä½¿ç”¨ SQL ä¸å®¹æ˜“è¡¨è¾¾çš„åœºæ™¯ï¼š</p><ul><li>BLOB å’Œ CLOB å˜æ›´</li><li>å¤§é‡æ•°æ®çš„é«˜çº§å˜æ›´ï¼ˆé‡æ–°è®¡ç®—ã€é«˜çº§æ ¼å¼å˜æ›´ï¼‰</li></ul><p><strong>å‘½åè§„åˆ™</strong></p><p>ä¸ºäº†è¢« Flyway è‡ªåŠ¨è¯†åˆ«ï¼ŒJAVA migrations çš„æ–‡ä»¶å‘½åå¿…é¡»éµå¾ªè§„å®šçš„æ¨¡å¼ï¼š</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/database/flyway/java-migrations.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><strong>Prefix</strong> - <code>V</code> ä»£è¡¨ versioned migrations (å¯é…ç½®), <code>U</code> ä»£è¡¨ undo migrations (å¯é…ç½®)ã€ <code>R</code> ä»£è¡¨ repeatable migrations (å¯é…ç½®)</li><li><strong>Version</strong> - ç‰ˆæœ¬å·é€šè¿‡<code>.</code>(ç‚¹)æˆ–<code>_</code>(ä¸‹åˆ’çº¿)åˆ†éš” (repeatable migrations ä¸éœ€è¦)</li><li><strong>Separator</strong> - <code>__</code> (ä¸¤ä¸ªä¸‹åˆ’çº¿) (å¯é…ç½®)</li><li><strong>Description</strong> - ä¸‹åˆ’çº¿æˆ–ç©ºæ ¼åˆ†éš”çš„å•è¯</li></ul><blockquote><p>ğŸ‘‰ æ›´å¤šç»†èŠ‚è¯·å‚è€ƒï¼š<a href="https://flywaydb.org/documentation/migrations" target="_blank" rel="noopener noreferrer">https://flywaydb.org/documentation/migrations</a></p></blockquote><h4 id="callbacks" tabindex="-1"><a class="header-anchor" href="#callbacks"><span>Callbacks</span></a></h4><blockquote><p>æ³¨ï¼šéƒ¨åˆ† events ä»…ä¸“ä¸šç‰ˆæ”¯æŒã€‚</p></blockquote><p>å°½ç®¡ Migrations å¯èƒ½å·²ç»æ»¡è¶³ç»å¤§éƒ¨åˆ†åœºæ™¯çš„éœ€è¦ï¼Œä½†æ˜¯æŸäº›æƒ…å†µä¸‹éœ€è¦ä½ ä¸€éåˆä¸€éçš„æ‰§è¡Œç›¸åŒçš„è¡Œä¸ºã€‚è¿™å¯èƒ½ä¼šé‡æ–°ç¼–è¯‘å­˜å‚¨è¿‡ç¨‹ï¼Œæ›´æ–°è§†å›¾ä»¥åŠè®¸å¤šå…¶ä»–ç±»å‹çš„å¼€é”€ã€‚</p><p>å› ä¸ºä»¥ä¸ŠåŸå› ï¼ŒFlyway æä¾›äº† Callbacksï¼Œç”¨äºåœ¨ Migrations ç”Ÿå‘½å‘¨æœŸä¸­æ·»åŠ é’©å­ã€‚</p><p>Callbacks å¯ä»¥ç”¨ SQL æˆ– JAVA æ¥å®ç°ã€‚</p><h5 id="sql-callbacks" tabindex="-1"><a class="header-anchor" href="#sql-callbacks"><span>SQL Callbacks</span></a></h5><p>SQL Callbacks çš„å‘½åè§„åˆ™ä¸ºï¼ševent å + SQL migrationã€‚</p><p>å¦‚ï¼š <code>beforeMigrate.sql</code>, <code>beforeEachMigrate.sql</code>, <code>afterEachMigrate.sql</code> ç­‰ã€‚</p><p>SQL Callbacks ä¹Ÿå¯ä»¥åŒ…å«æè¿°ï¼ˆdescriptionï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒSQL Callbacks æ–‡ä»¶å = event å + åˆ†éš”ç¬¦ + æè¿° + åç¼€ã€‚ä¾‹ï¼š<code>beforeRepair__vacuum.sql</code></p><p>å½“åŒä¸€ä¸ª event æœ‰å¤šä¸ª SQL callbacksï¼Œå°†æŒ‰ç…§å®ƒä»¬æè¿°ï¼ˆdescriptionï¼‰çš„é¡ºåºæ‰§è¡Œã€‚</p><blockquote><p><strong>æ³¨ï¼š</strong> Flyway ä¹Ÿæ”¯æŒä½ é…ç½®çš„ <code>sqlMigrationSuffixes</code>ã€‚</p></blockquote><h5 id="java-callbacks" tabindex="-1"><a class="header-anchor" href="#java-callbacks"><span>JAVA Callbacks</span></a></h5><blockquote><p>å½“ SQL Callbacks ä¸å¤Ÿæ–¹ä¾¿æ—¶ï¼Œæ‰åº”è€ƒè™‘ JAVA Callbacksã€‚</p></blockquote><p>JAVA Callbacks æœ‰ 3 ç§å½¢å¼ï¼š</p><ol><li><strong>åŸºäº Java çš„ Migrations</strong> - å®ç° JdbcMigrationã€SpringJdbcMigrationã€MigrationInfoProviderã€MigrationChecksumProviderã€ConfigurationAwareã€FlywayConfiguration</li><li><strong>åŸºäº Java çš„ Callbacks</strong> - å®ç° org.flywaydb.core.api.callback æ¥å£ã€‚</li><li><strong>è‡ªå®šä¹‰ Migration resolvers å’Œ executors</strong> - å®ç° MigrationResolverã€MigrationExecutorã€ConfigurationAwareã€FlywayConfiguration æ¥å£ã€‚</li></ol><blockquote><p>ğŸ‘‰ æ›´å¤šç»†èŠ‚è¯·å‚è€ƒï¼š<a href="https://flywaydb.org/documentation/callbacks" target="_blank" rel="noopener noreferrer">https://flywaydb.org/documentation/callbacks</a></p></blockquote><h4 id="error-handlers" tabindex="-1"><a class="header-anchor" href="#error-handlers"><span>Error Handlers</span></a></h4><blockquote><p>æ³¨ï¼šä»…ä¸“ä¸šç‰ˆæ”¯æŒã€‚</p></blockquote><p>ï¼ˆç•¥ï¼‰</p><h4 id="dry-runs" tabindex="-1"><a class="header-anchor" href="#dry-runs"><span>Dry Runs</span></a></h4><blockquote><p>æ³¨ï¼šä»…ä¸“ä¸šç‰ˆæ”¯æŒã€‚</p></blockquote><p>ï¼ˆç•¥ï¼‰</p><h3 id="å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤"><span>å‘½ä»¤</span></a></h3><p>Flyway çš„åŠŸèƒ½ä¸»è¦å›´ç»•ç€ 7 ä¸ªåŸºæœ¬å‘½ä»¤ï¼š<a href="https://flywaydb.org/documentation/command/migrate" target="_blank" rel="noopener noreferrer">Migrate</a>ã€<a href="https://flywaydb.org/documentation/command/clean" target="_blank" rel="noopener noreferrer">Clean</a>ã€<a href="https://flywaydb.org/documentation/command/info" target="_blank" rel="noopener noreferrer">Info</a>ã€<a href="https://flywaydb.org/documentation/command/validate" target="_blank" rel="noopener noreferrer">Validate</a>ã€<a href="https://flywaydb.org/documentation/command/undo" target="_blank" rel="noopener noreferrer">Undo</a>ã€<a href="https://flywaydb.org/documentation/command/baseline" target="_blank" rel="noopener noreferrer">Baseline</a> å’Œ <a href="https://flywaydb.org/documentation/command/repair" target="_blank" rel="noopener noreferrer">Repair</a>ã€‚</p><p>æ³¨ï¼šå„å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•ç»†èŠ‚è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚</p><h3 id="æ”¯æŒçš„æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#æ”¯æŒçš„æ•°æ®åº“"><span>æ”¯æŒçš„æ•°æ®åº“</span></a></h3><ul><li><a href="https://flywaydb.org/documentation/database/oracle" target="_blank" rel="noopener noreferrer">Oracle</a></li><li><a href="https://flywaydb.org/documentation/database/sqlserver" target="_blank" rel="noopener noreferrer">SQL Server</a></li><li><a href="https://flywaydb.org/documentation/database/db2" target="_blank" rel="noopener noreferrer">DB2</a></li><li><a href="https://flywaydb.org/documentation/database/mysql" target="_blank" rel="noopener noreferrer">MySQL</a></li><li><a href="https://flywaydb.org/documentation/database/mariadb" target="_blank" rel="noopener noreferrer">MariaDB</a></li><li><a href="https://flywaydb.org/documentation/database/postgresql" target="_blank" rel="noopener noreferrer">PostgreSQL</a></li><li><a href="https://flywaydb.org/documentation/database/redshift" target="_blank" rel="noopener noreferrer">Redshift</a></li><li><a href="https://flywaydb.org/documentation/database/cockroachdb" target="_blank" rel="noopener noreferrer">CockroachDB</a></li><li><a href="https://flywaydb.org/documentation/database/saphana" target="_blank" rel="noopener noreferrer">SAP HANA</a></li><li><a href="https://flywaydb.org/documentation/database/sybasease" target="_blank" rel="noopener noreferrer">Sybase ASE</a></li><li><a href="https://flywaydb.org/documentation/database/informix" target="_blank" rel="noopener noreferrer">Informix</a></li><li><a href="https://flywaydb.org/documentation/database/h2" target="_blank" rel="noopener noreferrer">H2</a></li><li><a href="https://flywaydb.org/documentation/database/hsqldb" target="_blank" rel="noopener noreferrer">HSQLDB</a></li><li><a href="https://flywaydb.org/documentation/database/derby" target="_blank" rel="noopener noreferrer">Derby</a></li><li><a href="https://flywaydb.org/documentation/database/sqlite" target="_blank" rel="noopener noreferrer">SQLite</a></li></ul><h2 id="èµ„æ–™" tabindex="-1"><a class="header-anchor" href="#èµ„æ–™"><span>èµ„æ–™</span></a></h2><p>| <a href="https://github.com/flyway/flyway" target="_blank" rel="noopener noreferrer">Github</a> | <a href="https://flywaydb.org/" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a> |</p><h2 id="ğŸšª-ä¼ é€" tabindex="-1"><a class="header-anchor" href="#ğŸšª-ä¼ é€"><span>ğŸšª ä¼ é€</span></a></h2><p>â—¾ ğŸ’§ <a href="https://dunwu.github.io/waterdrop/" target="_blank" rel="noopener noreferrer">é’æ‚Ÿçš„ IT çŸ¥è¯†å›¾è°±</a> â—¾</p>`,157)])])}const k=i(l,[["render",t]]),d=JSON.parse('{"path":"/pages/9464b967/","title":"ç‰ˆæœ¬ç®¡ç†ä¸­é—´ä»¶ Flyway","lang":"zh-CN","frontmatter":{"title":"ç‰ˆæœ¬ç®¡ç†ä¸­é—´ä»¶ Flyway","date":"2019-08-22T09:02:39.000Z","categories":["æ•°æ®åº“","æ•°æ®åº“ä¸­é—´ä»¶"],"tags":["æ•°æ®åº“","ä¸­é—´ä»¶","ç‰ˆæœ¬ç®¡ç†","flyway"],"permalink":"/pages/9464b967/","description":"ç‰ˆæœ¬ç®¡ç†ä¸­é—´ä»¶ Flyway Flyway æ˜¯ä¸€ä¸ªæ•°æ®è¿ç§»å·¥å…·ã€‚ ç®€ä»‹ ä»€ä¹ˆæ˜¯ Flyway Flyway æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®åº“è¿ç§»å·¥å…·ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®è¿ç§» åœ¨ä»£ç ä¾§ï¼ˆå³åº”ç”¨è½¯ä»¶ï¼‰çš„ç‰ˆæœ¬é—®é¢˜æ¯”è¾ƒå®¹æ˜“è§£å†³ï¼š æœ‰æ–¹ä¾¿çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…· æœ‰å¯å¤ç”¨çš„æ„å»ºå’ŒæŒç»­é›†æˆ è§„èŒƒçš„å‘å¸ƒå’Œéƒ¨ç½²è¿‡ç¨‹ é‚£ä¹ˆï¼Œæ•°æ®åº“å±‚é¢çš„ç‰ˆæœ¬é—®é¢˜å¦‚ä½•è§£å†³å‘¢ï¼Ÿ ç›®å‰ä»ç„¶æ²¡æœ‰æ–¹ä¾¿çš„æ•°æ®åº“ç‰ˆæœ¬å·¥å…·ã€‚è®¸...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ç‰ˆæœ¬ç®¡ç†ä¸­é—´ä»¶ Flyway\\",\\"image\\":[\\"https://raw.githubusercontent.com/dunwu/images/master/archive/2026/02/9baea6f7af01432ab3d12e54f3e0f90a.webp\\",\\"https://raw.githubusercontent.com/dunwu/images/master/archive/2026/02/22d3e352485c4241abc15d89608a7094.webp\\",\\"https://raw.githubusercontent.com/dunwu/images/master/archive/2026/02/8ee2f02c5ae4471fbbc965ae0999ae2b.webp\\",\\"https://raw.githubusercontent.com/dunwu/images/master/archive/2026/02/e5e96d8528b1485e9f9eddfe15290818.webp\\",\\"https://raw.githubusercontent.com/dunwu/images/master/archive/2026/02/da9d8ff9fcc9404491105c0b2b4ce3d8.webp\\",\\"https://raw.githubusercontent.com/dunwu/images/master/cs/database/flyway/sql-migrations.png\\",\\"https://raw.githubusercontent.com/dunwu/images/master/cs/database/flyway/java-migrations.png\\"],\\"datePublished\\":\\"2019-08-22T09:02:39.000Z\\",\\"dateModified\\":\\"2026-02-11T15:41:54.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"é’æ‚Ÿ\\",\\"url\\":\\"https://dunwu.github.io/waterdrop\\"}]}"],["meta",{"property":"og:url","content":"https://dunwu.github.io/waterdrop/waterdrop/pages/9464b967/"}],["meta",{"property":"og:site_name","content":"é’æ‚Ÿ"}],["meta",{"property":"og:title","content":"ç‰ˆæœ¬ç®¡ç†ä¸­é—´ä»¶ Flyway"}],["meta",{"property":"og:description","content":"ç‰ˆæœ¬ç®¡ç†ä¸­é—´ä»¶ Flyway Flyway æ˜¯ä¸€ä¸ªæ•°æ®è¿ç§»å·¥å…·ã€‚ ç®€ä»‹ ä»€ä¹ˆæ˜¯ Flyway Flyway æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®åº“è¿ç§»å·¥å…·ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®è¿ç§» åœ¨ä»£ç ä¾§ï¼ˆå³åº”ç”¨è½¯ä»¶ï¼‰çš„ç‰ˆæœ¬é—®é¢˜æ¯”è¾ƒå®¹æ˜“è§£å†³ï¼š æœ‰æ–¹ä¾¿çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…· æœ‰å¯å¤ç”¨çš„æ„å»ºå’ŒæŒç»­é›†æˆ è§„èŒƒçš„å‘å¸ƒå’Œéƒ¨ç½²è¿‡ç¨‹ é‚£ä¹ˆï¼Œæ•°æ®åº“å±‚é¢çš„ç‰ˆæœ¬é—®é¢˜å¦‚ä½•è§£å†³å‘¢ï¼Ÿ ç›®å‰ä»ç„¶æ²¡æœ‰æ–¹ä¾¿çš„æ•°æ®åº“ç‰ˆæœ¬å·¥å…·ã€‚è®¸..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/dunwu/images/master/archive/2026/02/9baea6f7af01432ab3d12e54f3e0f90a.webp"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-02-11T15:41:54.000Z"}],["meta",{"property":"article:tag","content":"flyway"}],["meta",{"property":"article:tag","content":"ç‰ˆæœ¬ç®¡ç†"}],["meta",{"property":"article:tag","content":"ä¸­é—´ä»¶"}],["meta",{"property":"article:tag","content":"æ•°æ®åº“"}],["meta",{"property":"article:published_time","content":"2019-08-22T09:02:39.000Z"}],["meta",{"property":"article:modified_time","content":"2026-02-11T15:41:54.000Z"}]]},"git":{"createdTime":1651071272000,"updatedTime":1770824514000,"contributors":[{"name":"dunwu","username":"dunwu","email":"forbreak@163.com","commits":12,"url":"https://github.com/dunwu"}]},"readingTime":{"minutes":7.99,"words":2398},"filePathRelative":"12.æ•°æ®åº“/æ•°æ®åº“ä¸­é—´ä»¶/Flyway.md","excerpt":"\\n<blockquote>\\n<p>Flyway æ˜¯ä¸€ä¸ªæ•°æ®è¿ç§»å·¥å…·ã€‚</p>\\n</blockquote>\\n<h2>ç®€ä»‹</h2>\\n<h3>ä»€ä¹ˆæ˜¯ Flyway</h3>\\n<p><strong>Flyway æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®åº“è¿ç§»å·¥å…·ã€‚</strong></p>\\n<h3>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®è¿ç§»</h3>\\n<p>åœ¨ä»£ç ä¾§ï¼ˆå³åº”ç”¨è½¯ä»¶ï¼‰çš„ç‰ˆæœ¬é—®é¢˜æ¯”è¾ƒå®¹æ˜“è§£å†³ï¼š</p>\\n<ul>\\n<li>æœ‰æ–¹ä¾¿çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·</li>\\n<li>æœ‰å¯å¤ç”¨çš„æ„å»ºå’ŒæŒç»­é›†æˆ</li>\\n<li>è§„èŒƒçš„å‘å¸ƒå’Œéƒ¨ç½²è¿‡ç¨‹</li>\\n</ul>\\n<p>é‚£ä¹ˆï¼Œæ•°æ®åº“å±‚é¢çš„ç‰ˆæœ¬é—®é¢˜å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>\\n<p>ç›®å‰ä»ç„¶æ²¡æœ‰æ–¹ä¾¿çš„æ•°æ®åº“ç‰ˆæœ¬å·¥å…·ã€‚è®¸å¤šé¡¹ç›®ä»ä½¿ç”¨ sql è„šæœ¬æ¥è§£å†³ç‰ˆæœ¬å†²çªï¼Œç”šè‡³æ˜¯é‡åˆ°å†²çªé—®é¢˜æ—¶æ‰æƒ³èµ·ç”¨ sql è¯­å¥å»è§£å†³ã€‚</p>","autoDesc":true}');export{k as comp,d as data};
