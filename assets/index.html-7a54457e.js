import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r,o as l,c as p,a,b as e,d as n,e as i}from"./app-0e67a029.js";const c={},d=a("h1",{id:"iptables-应用",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#iptables-应用","aria-hidden":"true"},"#"),e(" Iptables 应用")],-1),o=a("em",null,"iptables",-1),b={href:"https://wiki.archlinux.org/index.php/Firewall",target:"_blank",rel:"noopener noreferrer"},m={href:"https://en.wikipedia.org/wiki/Netfilter",target:"_blank",rel:"noopener noreferrer"},v={href:"https://en.wikipedia.org/wiki/Ipv4",target:"_blank",rel:"noopener noreferrer"},u=a("em",null,"ip6tables",-1),h={href:"https://en.wikipedia.org/wiki/Ipv6",target:"_blank",rel:"noopener noreferrer"},k={href:"https://wiki.archlinux.org/index.php/Nftables",target:"_blank",rel:"noopener noreferrer"},g={href:"http://www.phoronix.com/scan.php?page=news_item&px=MTQ5MDU",target:"_blank",rel:"noopener noreferrer"},P=a("p",null,"环境：CentOS7",-1),T=i(`<h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介" aria-hidden="true">#</a> 简介</h2><p><strong>iptables 可以检测、修改、转发、重定向和丢弃 IPv4 数据包</strong>。</p><p>过滤 IPv4 数据包的代码已经内置于内核中，并且按照不同的目的被组织成 <strong>表</strong> 的集合。<strong>表</strong> 由一组预先定义的 <strong>链</strong> 组成，<strong>链</strong>包含遍历顺序规则。每一条规则包含一个谓词的潜在匹配和相应的动作（称为 <strong>目标</strong>），如果谓词为真，该动作会被执行。也就是说条件匹配。</p><h2 id="安装-iptables" tabindex="-1"><a class="header-anchor" href="#安装-iptables" aria-hidden="true">#</a> 安装 iptables</h2><p>（1）禁用 firewalld</p><p>CentOS 7 上默认安装了 firewalld 作为防火墙，使用 iptables 建议关闭并禁用 firewalld。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl stop firewalld
systemctl disable firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）安装 iptables</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install -y iptables-services
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（3）服务管理</p><ul><li>查看服务状态：<code>systemctl status iptables</code></li><li>启用服务：<code>systemctl enable iptables</code></li><li>禁用服务：<code>systemctl disable iptables</code></li><li>启动服务：<code>systemctl start iptables</code></li><li>重启服务：<code>systemctl restart iptables</code></li><li>关闭服务: <code>systemctl stop iptables</code></li></ul><h2 id="命令" tabindex="-1"><a class="header-anchor" href="#命令" aria-hidden="true">#</a> 命令</h2><p>基本语法：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>iptables(选项)(参数)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>基本选项说明：</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-P</td><td>设置默认策略:iptables -P INPUT (DROP</td></tr><tr><td>-F</td><td>清空规则链</td></tr><tr><td>-L</td><td>查看规则链</td></tr><tr><td>-A</td><td>在规则链的末尾加入新规则</td></tr><tr><td>-I</td><td>num 在规则链的头部加入新规则</td></tr><tr><td>-D</td><td>num 删除某一条规则</td></tr><tr><td>-s</td><td>匹配来源地址 IP/MASK，加叹号&quot;!&quot;表示除这个 IP 外。</td></tr><tr><td>-d</td><td>匹配目标地址</td></tr><tr><td>-i</td><td>网卡名称 匹配从这块网卡流入的数据</td></tr><tr><td>-o</td><td>网卡名称 匹配从这块网卡流出的数据</td></tr><tr><td>-p</td><td>匹配协议,如 tcp,udp,icmp</td></tr><tr><td>--dport num</td><td>匹配目标端口号</td></tr><tr><td>--sport num</td><td>匹配来源端口号</td></tr></tbody></table><p>顺序：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>iptables -t 表名 &lt;-A/I/D/R&gt; 规则链名 [规则号] &lt;-i/o 网卡名&gt; -p 协议名 &lt;-s 源IP/源子网&gt; --sport 源端口 &lt;-d 目标IP/目标子网&gt; --dport 目标端口 -j 动作
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="iptables-示例" tabindex="-1"><a class="header-anchor" href="#iptables-示例" aria-hidden="true">#</a> iptables 示例</h2><h3 id="清空当前的所有规则和计数" tabindex="-1"><a class="header-anchor" href="#清空当前的所有规则和计数" aria-hidden="true">#</a> 清空当前的所有规则和计数</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-F</span>  <span class="token comment"># 清空所有的防火墙规则</span>
iptables <span class="token parameter variable">-X</span>  <span class="token comment"># 删除用户自定义的空链</span>
iptables <span class="token parameter variable">-Z</span>  <span class="token comment"># 清空计数</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置允许-ssh-端口连接" tabindex="-1"><a class="header-anchor" href="#配置允许-ssh-端口连接" aria-hidden="true">#</a> 配置允许 ssh 端口连接</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.1.0/24 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> ACCEPT
<span class="token comment"># 22为你的ssh端口， -s 192.168.1.0/24表示允许这个网段的机器来连接，其它网段的ip地址是登陆不了你的机器的。 -j ACCEPT表示接受这样的请求</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="允许本地回环地址可以正常使用" tabindex="-1"><a class="header-anchor" href="#允许本地回环地址可以正常使用" aria-hidden="true">#</a> 允许本地回环地址可以正常使用</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-i</span> lo <span class="token parameter variable">-j</span> ACCEPT
<span class="token comment">#本地圆环地址就是那个127.0.0.1，是本机上使用的,它进与出都设置为允许</span>
iptables <span class="token parameter variable">-A</span> OUTPUT <span class="token parameter variable">-o</span> lo <span class="token parameter variable">-j</span> ACCEPT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="设置默认的规则" tabindex="-1"><a class="header-anchor" href="#设置默认的规则" aria-hidden="true">#</a> 设置默认的规则</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-P</span> INPUT DROP <span class="token comment"># 配置默认的不让进</span>
iptables <span class="token parameter variable">-P</span> FORWARD DROP <span class="token comment"># 默认的不允许转发</span>
iptables <span class="token parameter variable">-P</span> OUTPUT ACCEPT <span class="token comment"># 默认的可以出去</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置白名单" tabindex="-1"><a class="header-anchor" href="#配置白名单" aria-hidden="true">#</a> 配置白名单</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> all <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.1.0/24 <span class="token parameter variable">-j</span> ACCEPT  <span class="token comment"># 允许机房内网机器可以访问</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> all <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.140.0/24 <span class="token parameter variable">-j</span> ACCEPT  <span class="token comment"># 允许机房内网机器可以访问</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-s</span> <span class="token number">183.121</span>.3.7 <span class="token parameter variable">--dport</span> <span class="token number">3380</span> <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许183.121.3.7访问本机的3380端口</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="开启相应的服务端口" tabindex="-1"><a class="header-anchor" href="#开启相应的服务端口" aria-hidden="true">#</a> 开启相应的服务端口</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 开启80端口，因为web对外都是这个端口</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> icmp --icmp-type <span class="token number">8</span> <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许被ping</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> ESTABLISHED,RELATED <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 已经建立的连接得让它进来</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="保存规则到配置文件中" tabindex="-1"><a class="header-anchor" href="#保存规则到配置文件中" aria-hidden="true">#</a> 保存规则到配置文件中</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cp</span> /etc/sysconfig/iptables /etc/sysconfig/iptables.bak <span class="token comment"># 任何改动之前先备份，请保持这一优秀的习惯</span>
iptables-save <span class="token operator">&gt;</span> /etc/sysconfig/iptables
<span class="token function">cat</span> /etc/sysconfig/iptables
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列出已设置的规则" tabindex="-1"><a class="header-anchor" href="#列出已设置的规则" aria-hidden="true">#</a> 列出已设置的规则</h3><blockquote><p>iptables -L [-t 表名][链名]</p></blockquote><ul><li>四个表名 <code>raw</code>，<code>nat</code>，<code>filter</code>，<code>mangle</code></li><li>五个规则链名 <code>INPUT</code>、<code>OUTPUT</code>、<code>FORWARD</code>、<code>PREROUTING</code>、<code>POSTROUTING</code></li><li>filter 表包含<code>INPUT</code>、<code>OUTPUT</code>、<code>FORWARD</code>三个规则链</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-L</span> <span class="token parameter variable">-t</span> nat                  <span class="token comment"># 列出 nat 上面的所有规则</span>
<span class="token comment">#            ^ -t 参数指定，必须是 raw， nat，filter，mangle 中的一个</span>
iptables <span class="token parameter variable">-L</span> <span class="token parameter variable">-t</span> nat  --line-numbers  <span class="token comment"># 规则带编号</span>
iptables <span class="token parameter variable">-L</span> INPUT

iptables <span class="token parameter variable">-L</span> <span class="token parameter variable">-nv</span>  <span class="token comment"># 查看，这个列表看起来更详细</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="清除已有规则" tabindex="-1"><a class="header-anchor" href="#清除已有规则" aria-hidden="true">#</a> 清除已有规则</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-F</span> INPUT  <span class="token comment"># 清空指定链 INPUT 上面的所有规则</span>
iptables <span class="token parameter variable">-X</span> INPUT  <span class="token comment"># 删除指定的链，这个链必须没有被其它任何规则引用，而且这条上必须没有任何规则。</span>
                   <span class="token comment"># 如果没有指定链名，则会删除该表中所有非内置的链。</span>
iptables <span class="token parameter variable">-Z</span> INPUT  <span class="token comment"># 把指定链，或者表中的所有链上的所有计数器清零。</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除已添加的规则" tabindex="-1"><a class="header-anchor" href="#删除已添加的规则" aria-hidden="true">#</a> 删除已添加的规则</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 添加一条规则</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.1.5 <span class="token parameter variable">-j</span> DROP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>将所有 iptables 以序号标记显示，执行：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-L</span> <span class="token parameter variable">-n</span> --line-numbers
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>比如要删除 INPUT 里序号为 8 的规则，执行：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-D</span> INPUT <span class="token number">8</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="开放指定的端口" tabindex="-1"><a class="header-anchor" href="#开放指定的端口" aria-hidden="true">#</a> 开放指定的端口</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-d</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-j</span> ACCEPT               <span class="token comment">#允许本地回环接口(即运行本机访问本机)</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> ESTABLISHED,RELATED <span class="token parameter variable">-j</span> ACCEPT    <span class="token comment">#允许已建立的或相关连的通行</span>
iptables <span class="token parameter variable">-A</span> OUTPUT <span class="token parameter variable">-j</span> ACCEPT         <span class="token comment">#允许所有本机向外的访问</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> ACCEPT    <span class="token comment">#允许访问22端口</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> ACCEPT    <span class="token comment">#允许访问80端口</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">21</span> <span class="token parameter variable">-j</span> ACCEPT    <span class="token comment">#允许ftp服务的21端口</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">20</span> <span class="token parameter variable">-j</span> ACCEPT    <span class="token comment">#允许FTP服务的20端口</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-j</span> reject       <span class="token comment">#禁止其他未允许的规则访问</span>
iptables <span class="token parameter variable">-A</span> FORWARD <span class="token parameter variable">-j</span> REJECT     <span class="token comment">#禁止其他未允许的规则访问</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="屏蔽-ip" tabindex="-1"><a class="header-anchor" href="#屏蔽-ip" aria-hidden="true">#</a> 屏蔽 IP</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> tcp <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.0.8 <span class="token parameter variable">-j</span> DROP  <span class="token comment"># 屏蔽恶意主机（比如，192.168.0.8</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">123.45</span>.6.7 <span class="token parameter variable">-j</span> DROP       <span class="token comment">#屏蔽单个IP的命令</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">123.0</span>.0.0/8 <span class="token parameter variable">-j</span> DROP      <span class="token comment">#封整个段即从123.0.0.1到123.255.255.254的命令</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">124.45</span>.0.0/16 <span class="token parameter variable">-j</span> DROP    <span class="token comment">#封IP段即从123.45.0.1到123.45.255.254的命令</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">123.45</span>.6.0/24 <span class="token parameter variable">-j</span> DROP    <span class="token comment">#封IP段即从123.45.6.1到123.45.6.254的命令是</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="指定数据包出去的网络接口" tabindex="-1"><a class="header-anchor" href="#指定数据包出去的网络接口" aria-hidden="true">#</a> 指定数据包出去的网络接口</h3><p>只对 OUTPUT，FORWARD，POSTROUTING 三个链起作用。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> FORWARD <span class="token parameter variable">-o</span> eth0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="查看已添加的规则" tabindex="-1"><a class="header-anchor" href="#查看已添加的规则" aria-hidden="true">#</a> 查看已添加的规则</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-L</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-v</span>
Chain INPUT <span class="token punctuation">(</span>policy DROP <span class="token number">48106</span> packets, 2690K bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
 <span class="token number">5075</span>  589K ACCEPT     all  --  lo     *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
 191K   90M ACCEPT     tcp  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0           tcp dpt:22
1499K  133M ACCEPT     tcp  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0           tcp dpt:80
4364K 6351M ACCEPT     all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0           state RELATED,ESTABLISHED
 <span class="token number">6256</span>  327K ACCEPT     icmp --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT 3382K packets, 1819M bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
 <span class="token number">5075</span>  589K ACCEPT     all  --  *      lo      <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动网络转发规则" tabindex="-1"><a class="header-anchor" href="#启动网络转发规则" aria-hidden="true">#</a> 启动网络转发规则</h3><p>公网<code>210.14.67.7</code>让内网<code>192.168.188.0/24</code>上网</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> POSTROUTING <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.188.0/24 <span class="token parameter variable">-j</span> SNAT --to-source <span class="token number">210.14</span>.67.127
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="端口映射" tabindex="-1"><a class="header-anchor" href="#端口映射" aria-hidden="true">#</a> 端口映射</h3><p>本机的 2222 端口映射到内网 虚拟机的 22 端口</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> PREROUTING <span class="token parameter variable">-d</span> <span class="token number">210.14</span>.67.127 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">2222</span>  <span class="token parameter variable">-j</span> DNAT --to-dest <span class="token number">192.168</span>.188.115:22
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="字符串匹配" tabindex="-1"><a class="header-anchor" href="#字符串匹配" aria-hidden="true">#</a> 字符串匹配</h3><p>比如，我们要过滤所有 TCP 连接中的字符串<code>test</code>，一旦出现它我们就终止这个连接，我们可以这么做：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> string <span class="token parameter variable">--algo</span> kmp <span class="token parameter variable">--string</span> <span class="token string">&quot;test&quot;</span> <span class="token parameter variable">-j</span> REJECT --reject-with tcp-reset
iptables <span class="token parameter variable">-L</span>

<span class="token comment"># Chain INPUT (policy ACCEPT)</span>
<span class="token comment"># target     prot opt source               destination</span>
<span class="token comment"># REJECT     tcp  --  anywhere             anywhere            STRING match &quot;test&quot; ALGO name kmp TO 65535 reject-with tcp-reset</span>
<span class="token comment">#</span>
<span class="token comment"># Chain FORWARD (policy ACCEPT)</span>
<span class="token comment"># target     prot opt source               destination</span>
<span class="token comment">#</span>
<span class="token comment"># Chain OUTPUT (policy ACCEPT)</span>
<span class="token comment"># target     prot opt source               destination</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="阻止-windows-蠕虫的攻击" tabindex="-1"><a class="header-anchor" href="#阻止-windows-蠕虫的攻击" aria-hidden="true">#</a> 阻止 Windows 蠕虫的攻击</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-j</span> DROP <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-s</span> <span class="token number">0.0</span>.0.0/0 <span class="token parameter variable">-m</span> string <span class="token parameter variable">--algo</span> kmp <span class="token parameter variable">--string</span> <span class="token string">&quot;cmd.exe&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="防止-syn-洪水攻击" tabindex="-1"><a class="header-anchor" href="#防止-syn-洪水攻击" aria-hidden="true">#</a> 防止 SYN 洪水攻击</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--syn</span> <span class="token parameter variable">-m</span> limit <span class="token parameter variable">--limit</span> <span class="token number">5</span>/second <span class="token parameter variable">-j</span> ACCEPT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h2>`,68),x={href:"https://wiki.archlinux.org/index.php/iptables_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)",target:"_blank",rel:"noopener noreferrer"},A={href:"https://wangchujiang.com/linux-command/c/iptables.html",target:"_blank",rel:"noopener noreferrer"};function C(f,I){const s=r("ExternalLinkIcon");return l(),p("div",null,[d,a("blockquote",null,[a("p",null,[o,e(" 是一个配置 Linux 内核 "),a("a",b,[e("防火墙"),n(s)]),e(" 的命令行工具，是 "),a("a",m,[e("netfilter"),n(s)]),e(" 项目的一部分。 可以直接配置，也可以通过许多前端和图形界面配置。")]),a("p",null,[e("iptables 也经常代指该内核级防火墙。iptables 用于 "),a("a",v,[e("ipv4"),n(s)]),e("，"),u,e(" 用于 "),a("a",h,[e("ipv6"),n(s)]),e("。")]),a("p",null,[a("a",k,[e("nftables"),n(s)]),e(" 已经包含在 "),a("a",g,[e("Linux kernel 3.13"),n(s)]),e(" 中，以后会取代 iptables 成为主要的 Linux 防火墙工具。")]),P]),T,a("ul",null,[a("li",null,[a("a",x,[e("https://wiki.archlinux.org/index.php/iptables_(简体中文)"),n(s)])]),a("li",null,[a("a",A,[e("https://wangchujiang.com/linux-command/c/iptables.html"),n(s)])])])])}const N=t(c,[["render",C],["__file","index.html.vue"]]);export{N as default};
