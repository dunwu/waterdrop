import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as i,c as l,a as n,b as s,d as t,f as c,e as p}from"./app-8aee0239.js";const r={},u=n("h1",{id:"mongodb-建模",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#mongodb-建模","aria-hidden":"true"},"#"),s(" MongoDB 建模")],-1),d={class:"hint-container info"},k=n("p",{class:"hint-container-title"},"概述",-1),v=n("p",null,[s("数据建模是指对数据库中的数据以及相关实体间的链接进行组织。MongoDB 中的数据具有"),n("strong",null,"灵活的模式模型"),s("，因此：")],-1),m={href:"https://www.mongodb.com/zh-cn/docs/manual/reference/glossary/#std-term-collection",target:"_blank",rel:"noopener noreferrer"},q={href:"https://www.mongodb.com/zh-cn/docs/manual/reference/glossary/#std-term-document",target:"_blank",rel:"noopener noreferrer"},g=n("li",null,"字段的数据类型可能因集合中的文档而异。",-1),b={href:"https://www.mongodb.com/zh-cn/docs/manual/core/schema-validation/#std-label-schema-validation-overview",target:"_blank",rel:"noopener noreferrer"},h=p('<h2 id="模式设计-关系数据库和文档数据库的差异" tabindex="-1"><a class="header-anchor" href="#模式设计-关系数据库和文档数据库的差异" aria-hidden="true">#</a> 模式设计：关系数据库和文档数据库的差异</h2><p>为 MongoDB 等文档数据库设计模式时，需要考虑与关系数据库的一些重要区别。</p><table><thead><tr><th style="text-align:left;">关系数据库行为</th><th style="text-align:left;">文档数据库行为</th></tr></thead><tbody><tr><td style="text-align:left;">在插入数据之前，您必须确定表格的模式。</td><td style="text-align:left;">随着应用程序需求的变化，模式可能会随时间而变化。</td></tr><tr><td style="text-align:left;">您经常需要连接来自多个不同表格的数据，以返回应用程序所需的数据。</td><td style="text-align:left;">灵活的数据模型使您可以存储数据以匹配应用程序返回数据的方式，并避免连接。避免多个集合之间的连接可以提高性能，并减少部署工作量。</td></tr></tbody></table><h2 id="文档数据模型" tabindex="-1"><a class="header-anchor" href="#文档数据模型" aria-hidden="true">#</a> 文档数据模型</h2><p>MongoDB 是无模式的，那么文档之间如何关联呢？要关联文档数据，有两种方式：</p><ul><li>嵌入式数据模型</li><li>引用式数据模型</li></ul><h3 id="嵌入式数据模型" tabindex="-1"><a class="header-anchor" href="#嵌入式数据模型" aria-hidden="true">#</a> 嵌入式数据模型</h3><p>嵌入式文档在单一文档结构中存储相关数据。文档可以包含具有相关数据的数组和子文档。这些<strong>非规范化</strong>数据模型允许应用程序在单个数据库操作中检索相关数据。</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202503072153634.svg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',9),y={href:"https://www.mongodb.com/zh-cn/docs/manual/data-modeling/concepts/embedding-vs-references/#std-label-data-modeling-embedding",target:"_blank",rel:"noopener noreferrer"},_=p('<h3 id="引用式数据模型" tabindex="-1"><a class="header-anchor" href="#引用式数据模型" aria-hidden="true">#</a> 引用式数据模型</h3><p>引用通过包含从一个文档到另一个文档的链接（称为<strong>引用</strong>）来存储数据之间的关系。例如，<code>orders</code> 集合中的 <code>customerId</code> 字段表示对 <code>customers</code> 集合中文档的引用。</p><p>应用程序可以通过解析这些引用来访问相关数据。从广义上讲，这些是<strong>规范化</strong>数据模型。</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202503072157794.svg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',4),f={href:"https://www.mongodb.com/zh-cn/docs/manual/data-modeling/concepts/embedding-vs-references/#std-label-data-modeling-referencing",target:"_blank",rel:"noopener noreferrer"},x=p(`<h2 id="关系型模型" tabindex="-1"><a class="header-anchor" href="#关系型模型" aria-hidden="true">#</a> 关系型模型</h2><h3 id="嵌入式文档一对一关系模型" tabindex="-1"><a class="header-anchor" href="#嵌入式文档一对一关系模型" aria-hidden="true">#</a> 嵌入式文档一对一关系模型</h3><h4 id="嵌入式文档一对一关系模型-嵌入式文档模式" tabindex="-1"><a class="header-anchor" href="#嵌入式文档一对一关系模型-嵌入式文档模式" aria-hidden="true">#</a> 嵌入式文档一对一关系模型 - 嵌入式文档模式</h4><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// patron document</span>
<span class="token punctuation">{</span>
   _id<span class="token operator">:</span> <span class="token string">&quot;joe&quot;</span><span class="token punctuation">,</span>
   name<span class="token operator">:</span> <span class="token string">&quot;Joe Bookreader&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">// address document</span>
<span class="token punctuation">{</span>
   patron_id<span class="token operator">:</span> <span class="token string">&quot;joe&quot;</span><span class="token punctuation">,</span> <span class="token comment">// reference to patron document</span>
   street<span class="token operator">:</span> <span class="token string">&quot;123 Fake Street&quot;</span><span class="token punctuation">,</span>
   city<span class="token operator">:</span> <span class="token string">&quot;Faketon&quot;</span><span class="token punctuation">,</span>
   state<span class="token operator">:</span> <span class="token string">&quot;MA&quot;</span><span class="token punctuation">,</span>
   zip<span class="token operator">:</span> <span class="token string">&quot;12345&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>合并为：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;joe&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Joe Bookreader&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;street&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123 Fake Street&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;city&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Faketon&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MA&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;zip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;12345&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="嵌入式文档一对一关系模型-子集模式" tabindex="-1"><a class="header-anchor" href="#嵌入式文档一对一关系模型-子集模式" aria-hidden="true">#</a> 嵌入式文档一对一关系模型 - 子集模式</h4><p>假设，有一个用于描述电影信息的 collection 定义：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;The Arrival of a Train&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;year&quot;</span><span class="token operator">:</span> <span class="token number">1896</span><span class="token punctuation">,</span>
  <span class="token property">&quot;runtime&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;released&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;01-25-1896&quot;</span>)<span class="token punctuation">,</span>
  <span class="token property">&quot;poster&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://ia.media-imdb.com/images/M/MV5BMjEyNDk5MDYzOV5BMl5BanBnXkFtZTgwNjIxMTEwMzE@._V1_SX300.jpg&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plot&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, ...&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;fullplot&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, the line dissolves. The doors of the railway-cars open, and people on the platform help passengers to get off.&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;lastupdated&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;2015-08-15T10:06:53&quot;</span>)<span class="token punctuation">,</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;movie&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;directors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Auguste Lumière&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Louis Lumière&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;imdb&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;rating&quot;</span><span class="token operator">:</span> <span class="token number">7.3</span><span class="token punctuation">,</span>
    <span class="token property">&quot;votes&quot;</span><span class="token operator">:</span> <span class="token number">5043</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">12</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;countries&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;France&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;genres&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Documentary&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Short&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tomatoes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;viewer&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;rating&quot;</span><span class="token operator">:</span> <span class="token number">3.7</span><span class="token punctuation">,</span>
      <span class="token property">&quot;numReviews&quot;</span><span class="token operator">:</span> <span class="token number">59</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lastUpdated&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;2020-01-09T00:02:53&quot;</span>)
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在应用中，有的场景只需要显示电影的简单浏览信息，不需要显示类似 fullplot、poster 这样的详细信息。因为，我们可以考虑将原结构一份为二，并通过 id 字段关联起来。</p><p>用于展示摘要信息的 movie collection</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// movie collection</span>

<span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;The Arrival of a Train&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;year&quot;</span><span class="token operator">:</span> <span class="token number">1896</span><span class="token punctuation">,</span>
  <span class="token property">&quot;runtime&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;released&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;1896-01-25&quot;</span>)<span class="token punctuation">,</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;movie&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;directors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Auguste Lumière&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Louis Lumière&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;countries&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;France&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;genres&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Documentary&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Short&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用于展示细节信息的 movie_details collection</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// movie_details collection</span>

<span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token number">156</span><span class="token punctuation">,</span>
  <span class="token property">&quot;movie_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// reference to the movie collection</span>
  <span class="token property">&quot;poster&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://ia.media-imdb.com/images/M/MV5BMjEyNDk5MDYzOV5BMl5BanBnXkFtZTgwNjIxMTEwMzE@._V1_SX300.jpg&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plot&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, ...&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;fullplot&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, the line dissolves. The doors of the railway-cars open, and people on the platform help passengers to get off.&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;lastupdated&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;2015-08-15T10:06:53&quot;</span>)<span class="token punctuation">,</span>
  <span class="token property">&quot;imdb&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;rating&quot;</span><span class="token operator">:</span> <span class="token number">7.3</span><span class="token punctuation">,</span>
    <span class="token property">&quot;votes&quot;</span><span class="token operator">:</span> <span class="token number">5043</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">12</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tomatoes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;viewer&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;rating&quot;</span><span class="token operator">:</span> <span class="token number">3.7</span><span class="token punctuation">,</span>
      <span class="token property">&quot;numReviews&quot;</span><span class="token operator">:</span> <span class="token number">59</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lastUpdated&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;2020-01-29T00:02:53&quot;</span>)
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="嵌入式文档一对多关系模型" tabindex="-1"><a class="header-anchor" href="#嵌入式文档一对多关系模型" aria-hidden="true">#</a> 嵌入式文档一对多关系模型</h3><h4 id="嵌入式文档一对多关系模型-嵌入式文档模式" tabindex="-1"><a class="header-anchor" href="#嵌入式文档一对多关系模型-嵌入式文档模式" aria-hidden="true">#</a> 嵌入式文档一对多关系模型 - 嵌入式文档模式</h4><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// patron document</span>
<span class="token punctuation">{</span>
   _id<span class="token operator">:</span> <span class="token string">&quot;joe&quot;</span><span class="token punctuation">,</span>
   name<span class="token operator">:</span> <span class="token string">&quot;Joe Bookreader&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">// address documents</span>
<span class="token punctuation">{</span>
   patron_id<span class="token operator">:</span> <span class="token string">&quot;joe&quot;</span><span class="token punctuation">,</span> <span class="token comment">// reference to patron document</span>
   street<span class="token operator">:</span> <span class="token string">&quot;123 Fake Street&quot;</span><span class="token punctuation">,</span>
   city<span class="token operator">:</span> <span class="token string">&quot;Faketon&quot;</span><span class="token punctuation">,</span>
   state<span class="token operator">:</span> <span class="token string">&quot;MA&quot;</span><span class="token punctuation">,</span>
   zip<span class="token operator">:</span> <span class="token string">&quot;12345&quot;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
   patron_id<span class="token operator">:</span> <span class="token string">&quot;joe&quot;</span><span class="token punctuation">,</span>
   street<span class="token operator">:</span> <span class="token string">&quot;1 Some Other Street&quot;</span><span class="token punctuation">,</span>
   city<span class="token operator">:</span> <span class="token string">&quot;Boston&quot;</span><span class="token punctuation">,</span>
   state<span class="token operator">:</span> <span class="token string">&quot;MA&quot;</span><span class="token punctuation">,</span>
   zip<span class="token operator">:</span> <span class="token string">&quot;12345&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>合并为：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;joe&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Joe Bookreader&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;addresses&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;street&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123 Fake Street&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;city&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Faketon&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MA&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;zip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;12345&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;street&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1 Some Other Street&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;city&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Boston&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MA&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;zip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;12345&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="嵌入式文档一对多关系模型-子集模式" tabindex="-1"><a class="header-anchor" href="#嵌入式文档一对多关系模型-子集模式" aria-hidden="true">#</a> 嵌入式文档一对多关系模型 - 子集模式</h4><p>考虑一个电商网站用于表示商品的 collection：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Super Widget&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;This is the most useful item in your toolbox.&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> NumberDecimal(<span class="token string">&quot;119.99&quot;</span>)<span class="token punctuation">,</span> <span class="token property">&quot;currency&quot;</span><span class="token operator">:</span> <span class="token string">&quot;USD&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;reviews&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;review_id&quot;</span><span class="token operator">:</span> <span class="token number">786</span><span class="token punctuation">,</span>
      <span class="token property">&quot;review_author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Kristina&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;review_text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;This is indeed an amazing widget.&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;published_date&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;2019-02-18&quot;</span>)
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;review_id&quot;</span><span class="token operator">:</span> <span class="token number">785</span><span class="token punctuation">,</span>
      <span class="token property">&quot;review_author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Trina&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;review_text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Nice product. Slow shipping.&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;published_date&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;2019-02-17&quot;</span>)
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ...<span class="token punctuation">{</span>
      <span class="token property">&quot;review_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;review_author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hans&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;review_text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Meh, it&#39;s okay.&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;published_date&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;2017-12-06&quot;</span>)
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>评论按时间倒序排列。 当用户访问产品页面时，应用程序将加载十条最近的评论。可以将集合分为两个集合，而不是与产品一起存储所有评论：</p><p>产品集合存储有关每个产品的信息，包括产品的十个最新评论：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Super Widget&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;This is the most useful item in your toolbox.&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> NumberDecimal(<span class="token string">&quot;119.99&quot;</span>)<span class="token punctuation">,</span> <span class="token property">&quot;currency&quot;</span><span class="token operator">:</span> <span class="token string">&quot;USD&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;reviews&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;review_id&quot;</span><span class="token operator">:</span> <span class="token number">786</span><span class="token punctuation">,</span>
      <span class="token property">&quot;review_author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Kristina&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;review_text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;This is indeed an amazing widget.&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;published_date&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;2019-02-18&quot;</span>)
    <span class="token punctuation">}</span>
    ...
    <span class="token punctuation">{</span>
      <span class="token property">&quot;review_id&quot;</span><span class="token operator">:</span> <span class="token number">776</span><span class="token punctuation">,</span>
      <span class="token property">&quot;review_author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Pablo&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;review_text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Amazing!&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;published_date&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;2019-02-16&quot;</span>)
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>review collection 存储所有的评论</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;review_id&quot;</span><span class="token operator">:</span> <span class="token number">786</span><span class="token punctuation">,</span>
  <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;review_author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Kristina&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;review_text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;This is indeed an amazing widget.&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;published_date&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;2019-02-18&quot;</span>)
<span class="token punctuation">}</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;review_id&quot;</span><span class="token operator">:</span> <span class="token number">785</span><span class="token punctuation">,</span>
  <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;review_author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Trina&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;review_text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Nice product. Slow shipping.&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;published_date&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;2019-02-17&quot;</span>)
<span class="token punctuation">}</span>
...
<span class="token punctuation">{</span>
  <span class="token property">&quot;review_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;review_author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hans&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;review_text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Meh, it&#39;s okay.&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;published_date&quot;</span><span class="token operator">:</span> ISODate(<span class="token string">&quot;2017-12-06&quot;</span>)
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="引用式文档一对多关系模型" tabindex="-1"><a class="header-anchor" href="#引用式文档一对多关系模型" aria-hidden="true">#</a> 引用式文档一对多关系模型</h3><p>考虑以下映射出版商和书籍关系的示例。</p><p>该示例说明了引用式文档的优点，以避免重复发布者信息。</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
   title<span class="token operator">:</span> <span class="token string">&quot;MongoDB: The Definitive Guide&quot;</span><span class="token punctuation">,</span>
   author<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Kristina Chodorow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mike Dirolf&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
   published_date<span class="token operator">:</span> ISODate(<span class="token string">&quot;2010-09-24&quot;</span>)<span class="token punctuation">,</span>
   pages<span class="token operator">:</span> <span class="token number">216</span><span class="token punctuation">,</span>
   language<span class="token operator">:</span> <span class="token string">&quot;English&quot;</span><span class="token punctuation">,</span>
   publisher<span class="token operator">:</span> <span class="token punctuation">{</span>
              name<span class="token operator">:</span> <span class="token string">&quot;O&#39;Reilly Media&quot;</span><span class="token punctuation">,</span>
              founded<span class="token operator">:</span> <span class="token number">1980</span><span class="token punctuation">,</span>
              location<span class="token operator">:</span> <span class="token string">&quot;CA&quot;</span>
            <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
   title<span class="token operator">:</span> <span class="token string">&quot;50 Tips and Tricks for MongoDB Developer&quot;</span><span class="token punctuation">,</span>
   author<span class="token operator">:</span> <span class="token string">&quot;Kristina Chodorow&quot;</span><span class="token punctuation">,</span>
   published_date<span class="token operator">:</span> ISODate(<span class="token string">&quot;2011-05-06&quot;</span>)<span class="token punctuation">,</span>
   pages<span class="token operator">:</span> <span class="token number">68</span><span class="token punctuation">,</span>
   language<span class="token operator">:</span> <span class="token string">&quot;English&quot;</span><span class="token punctuation">,</span>
   publisher<span class="token operator">:</span> <span class="token punctuation">{</span>
              name<span class="token operator">:</span> <span class="token string">&quot;O&#39;Reilly Media&quot;</span><span class="token punctuation">,</span>
              founded<span class="token operator">:</span> <span class="token number">1980</span><span class="token punctuation">,</span>
              location<span class="token operator">:</span> <span class="token string">&quot;CA&quot;</span>
            <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为避免重复出版商数据，可以使用引用型文档，并将出版商信息与书本分开保存。 使用引用时，关系的增长决定了将引用存储在何处。 如果每个出版商的图书数量很少且增长有限，则有时将图书参考存储在出版商文档中可能会很有用。 否则，如果每个发布者的书籍数量不受限制，则此数据模型将导致可变的，不断增长的数组，如以下示例所示：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
   name<span class="token operator">:</span> <span class="token string">&quot;O&#39;Reilly Media&quot;</span><span class="token punctuation">,</span>
   founded<span class="token operator">:</span> <span class="token number">1980</span><span class="token punctuation">,</span>
   location<span class="token operator">:</span> <span class="token string">&quot;CA&quot;</span><span class="token punctuation">,</span>
   books<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">123456789</span><span class="token punctuation">,</span> <span class="token number">234567890</span><span class="token punctuation">,</span> ...<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">123456789</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">&quot;MongoDB: The Definitive Guide&quot;</span><span class="token punctuation">,</span>
    author<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Kristina Chodorow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mike Dirolf&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    published_date<span class="token operator">:</span> ISODate(<span class="token string">&quot;2010-09-24&quot;</span>)<span class="token punctuation">,</span>
    pages<span class="token operator">:</span> <span class="token number">216</span><span class="token punctuation">,</span>
    language<span class="token operator">:</span> <span class="token string">&quot;English&quot;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
   _id<span class="token operator">:</span> <span class="token number">234567890</span><span class="token punctuation">,</span>
   title<span class="token operator">:</span> <span class="token string">&quot;50 Tips and Tricks for MongoDB Developer&quot;</span><span class="token punctuation">,</span>
   author<span class="token operator">:</span> <span class="token string">&quot;Kristina Chodorow&quot;</span><span class="token punctuation">,</span>
   published_date<span class="token operator">:</span> ISODate(<span class="token string">&quot;2011-05-06&quot;</span>)<span class="token punctuation">,</span>
   pages<span class="token operator">:</span> <span class="token number">68</span><span class="token punctuation">,</span>
   language<span class="token operator">:</span> <span class="token string">&quot;English&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了避免可变的，增长的数组，请将发行者参考存储在书籍文档中：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
   _id<span class="token operator">:</span> <span class="token string">&quot;oreilly&quot;</span><span class="token punctuation">,</span>
   name<span class="token operator">:</span> <span class="token string">&quot;O&#39;Reilly Media&quot;</span><span class="token punctuation">,</span>
   founded<span class="token operator">:</span> <span class="token number">1980</span><span class="token punctuation">,</span>
   location<span class="token operator">:</span> <span class="token string">&quot;CA&quot;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
   _id<span class="token operator">:</span> <span class="token number">123456789</span><span class="token punctuation">,</span>
   title<span class="token operator">:</span> <span class="token string">&quot;MongoDB: The Definitive Guide&quot;</span><span class="token punctuation">,</span>
   author<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Kristina Chodorow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mike Dirolf&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
   published_date<span class="token operator">:</span> ISODate(<span class="token string">&quot;2010-09-24&quot;</span>)<span class="token punctuation">,</span>
   pages<span class="token operator">:</span> <span class="token number">216</span><span class="token punctuation">,</span>
   language<span class="token operator">:</span> <span class="token string">&quot;English&quot;</span><span class="token punctuation">,</span>
   publisher_id<span class="token operator">:</span> <span class="token string">&quot;oreilly&quot;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
   _id<span class="token operator">:</span> <span class="token number">234567890</span><span class="token punctuation">,</span>
   title<span class="token operator">:</span> <span class="token string">&quot;50 Tips and Tricks for MongoDB Developer&quot;</span><span class="token punctuation">,</span>
   author<span class="token operator">:</span> <span class="token string">&quot;Kristina Chodorow&quot;</span><span class="token punctuation">,</span>
   published_date<span class="token operator">:</span> ISODate(<span class="token string">&quot;2011-05-06&quot;</span>)<span class="token punctuation">,</span>
   pages<span class="token operator">:</span> <span class="token number">68</span><span class="token punctuation">,</span>
   language<span class="token operator">:</span> <span class="token string">&quot;English&quot;</span><span class="token punctuation">,</span>
   publisher_id<span class="token operator">:</span> <span class="token string">&quot;oreilly&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="树形结构模型" tabindex="-1"><a class="header-anchor" href="#树形结构模型" aria-hidden="true">#</a> 树形结构模型</h2><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20200911194846.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="具有父节点的树形结构模型" tabindex="-1"><a class="header-anchor" href="#具有父节点的树形结构模型" aria-hidden="true">#</a> 具有父节点的树形结构模型</h3><p>上图结构可以用父引用来表示：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>db.categories.insertMany(<span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MongoDB&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Databases&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dbm&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Databases&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Databases&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Programming&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Languages&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Programming&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Programming&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Books&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Books&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,40),w=p(`<li><p>检索节点的父节点：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.categories.findOne( { _id: &quot;MongoDB&quot; } ).parent
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>可以在父字段上创建索引以启用父节点的快速搜索：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.categories.createIndex( { parent: 1 } )
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>可以通过父字段查询找到其直接子节点：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.categories.find( { parent: &quot;Databases&quot; } )
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>`,3),j={href:"https://docs.mongodb.com/manual/reference/operator/aggregation/graphLookup/#pipe._S_graphLookup",target:"_blank",rel:"noopener noreferrer"},D=n("code",null,"$graphLookup",-1),B=p(`<h3 id="具有子节点的树形结构模型" tabindex="-1"><a class="header-anchor" href="#具有子节点的树形结构模型" aria-hidden="true">#</a> 具有子节点的树形结构模型</h3><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>db.categories.insertMany(<span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MongoDB&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dbm&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Databases&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;MongoDB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dbm&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Languages&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Programming&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Databases&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Languages&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Books&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Programming&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>检索节点的 children：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.categories.findOne( { _id: &quot;Databases&quot; } ).children
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>可以在 children 字段上创建索引以启用子节点的快速搜索：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.categories.createIndex( { children: 1 } )
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>可以在 children 字段中查询节点，以找到其父节点及其兄弟节点：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.categories.find( { children: &quot;MongoDB&quot; } )
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h3 id="具有祖先的树形结构模型" tabindex="-1"><a class="header-anchor" href="#具有祖先的树形结构模型" aria-hidden="true">#</a> 具有祖先的树形结构模型</h3><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>db.categories.insertMany(<span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MongoDB&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ancestors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Books&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Programming&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Databases&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Databases&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dbm&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ancestors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Books&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Programming&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Databases&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Databases&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Databases&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ancestors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Books&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Programming&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Programming&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Languages&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ancestors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Books&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Programming&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Programming&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Programming&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;ancestors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Books&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Books&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Books&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;ancestors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>检索节点的祖先或路径的查询是快速而直接的：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>db.categories.findOne(<span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MongoDB&quot;</span> <span class="token punctuation">}</span>).ancestors
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>可以在 ancestors 字段上创建索引，以启用祖先节点的快速搜索：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>db.categories.createIndex(<span class="token punctuation">{</span> <span class="token property">&quot;ancestors&quot;</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>可以通过 ancestors 字段查询查找其所有后代：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>db.categories.find(<span class="token punctuation">{</span> <span class="token property">&quot;ancestors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Programming&quot;</span> <span class="token punctuation">}</span>)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h3 id="具有实体化路径的树形结构模型" tabindex="-1"><a class="header-anchor" href="#具有实体化路径的树形结构模型" aria-hidden="true">#</a> 具有实体化路径的树形结构模型</h3><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>db.categories.insertMany(<span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Books&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Programming&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;,Books,&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Databases&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;,Books,Programming,&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Languages&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;,Books,Programming,&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MongoDB&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;,Books,Programming,Databases,&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dbm&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;,Books,Programming,Databases,&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>可以查询以检索整个树，并按字段路径排序：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.categories.find().sort( { path: 1 } )
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>可以在 path 字段上使用正则表达式来查找 Programming 的后代</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.categories.find( { path: /,Programming,/ } )
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>可以检索 Books 的后代，其中 Books 也位于层次结构的最高级别：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.categories.find( { path: /^,Books,/ } )
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>要在 path 字段上创建索引，请使用以下调用：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.categories.createIndex( { path: 1 } )
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h3 id="具有嵌套集的树形结构模型" tabindex="-1"><a class="header-anchor" href="#具有嵌套集的树形结构模型" aria-hidden="true">#</a> 具有嵌套集的树形结构模型</h3><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20200911204252.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>categories<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;Books&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token number">12</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;Programming&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token string">&#39;Books&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token number">11</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;Languages&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token string">&#39;Programming&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;Databases&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token string">&#39;Programming&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;MongoDB&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token string">&#39;Databases&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;dbm&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token string">&#39;Databases&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token number">9</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以查询以检索节点的后代：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> databaseCategory <span class="token operator">=</span> db<span class="token punctuation">.</span>categories<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;Databases&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>categories<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$gt</span><span class="token operator">:</span> databaseCategory<span class="token punctuation">.</span>left <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$lt</span><span class="token operator">:</span> databaseCategory<span class="token punctuation">.</span>right <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="设计模式" tabindex="-1"><a class="header-anchor" href="#设计模式" aria-hidden="true">#</a> 设计模式</h2><h3 id="大文档-很多列-很多索引" tabindex="-1"><a class="header-anchor" href="#大文档-很多列-很多索引" aria-hidden="true">#</a> 大文档，很多列，很多索引</h3><p>解决方案是：列转行</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20200919225901.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="管理文档不同版本" tabindex="-1"><a class="header-anchor" href="#管理文档不同版本" aria-hidden="true">#</a> 管理文档不同版本</h3><p>MongoDB 文档格式非常灵活，势必会带来版本维护上的难度。</p><p>解决方案是：可以增加一个版本号字段</p><ul><li>快速过滤掉不需要升级的文档</li><li>升级时，对不同版本的文档做不同处理</li></ul><h3 id="统计网页点击量" tabindex="-1"><a class="header-anchor" href="#统计网页点击量" aria-hidden="true">#</a> 统计网页点击量</h3><p>统计数据精确性要求并不是十分重要。</p><p>解决方案：用近似计算</p><p>每隔 10 次写一次：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">&quot;$inc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;views&quot;</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="精确统计" tabindex="-1"><a class="header-anchor" href="#精确统计" aria-hidden="true">#</a> 精确统计</h3><p>解决方案：使用预聚合</p><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h2>`,30),M={href:"https://www.mongodb.com/zh-cn/docs/manual/data-modeling/",target:"_blank",rel:"noopener noreferrer"};function S(O,T){const a=o("ExternalLinkIcon");return i(),l("div",null,[u,n("div",d,[k,v,n("ul",null,[n("li",null,[s("单个 "),n("a",m,[s("集合"),t(a)]),s(" 中的 "),n("a",q,[s("文档"),t(a)]),s(" 不必具有相同的字段集。")]),g]),n("p",null,[s("通常，集合中的文档具有相似的结构。为确保数据模型的一致性，可以创建 "),n("a",b,[s("模式验证规则"),t(a)]),s("。")])]),c(" more "),h,n("blockquote",null,[n("p",null,[s("扩展阅读："),n("a",y,[s("嵌入式数据模型"),t(a)])])]),_,n("blockquote",null,[n("p",null,[s("扩展阅读："),n("a",f,[s("引用式数据模型"),t(a)])])]),x,n("ul",null,[w,n("li",null,[n("p",null,[s("检索子树，可以参考： "),n("a",j,[D,t(a)]),s(".")])])]),B,n("ul",null,[n("li",null,[n("a",M,[s("MongoDB 官方文档之数据建模"),t(a)])])])])}const P=e(r,[["render",S],["__file","index.html.vue"]]);export{P as default};
