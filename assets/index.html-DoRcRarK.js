import{_ as k}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as r,a as t,d,w as a,r as p,o as g,b as i,e as s}from"./app-PnIX1L9C.js";const c={};function o(A,n){const h=p("Tabs");return g(),r("div",null,[n[8]||(n[8]=t(`<h1 id="nginx-面试" tabindex="-1"><a class="header-anchor" href="#nginx-面试"><span>Nginx 面试</span></a></h1><h2 id="【中等】如何限制上传文件大小" tabindex="-1"><a class="header-anchor" href="#【中等】如何限制上传文件大小"><span>【中等】如何限制上传文件大小？</span></a></h2><p>显示错误信息：<strong>413 Request Entity Too Large</strong>。</p><p>意思是请求的内容过大，浏览器不能正确显示。常见的情况是发送 <code>POST</code> 请求来上传大文件。</p><p><strong>解决方法</strong></p><ul><li>可以在 <code>http</code> 模块中设置：<code>client_max_body_size 20m;</code></li><li>可以在 <code>server</code> 模块中设置：<code>client_max_body_size 20m;</code></li><li>可以在 <code>location</code> 模块中设置：<code>client_max_body_size 20m;</code></li></ul><p>三者区别是：</p><ul><li>如果文大小限制设置在 <code>http</code> 模块中，则对所有 Nginx 收到的请求。</li><li>如果文大小限制设置在 <code>server</code> 模块中，则只对该 <code>server</code> 收到的请求生效。</li><li>如果文大小限制设置在 <code>location</code> 模块中，则只对匹配了 <code>location</code> 路由规则的请求生效。</li></ul><h2 id="【中等】什么是-nginx" tabindex="-1"><a class="header-anchor" href="#【中等】什么是-nginx"><span>【中等】什么是 Nginx？</span></a></h2><p>Nginx 是一个高性能、开源的 <strong>Web 服务器</strong>软件。但它更核心的现代角色是作为<strong>反向代理服务器</strong>和<strong>负载均衡器</strong>。</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/web/nginx/nginx.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>核心特点</strong>：采用<strong>事件驱动</strong>的异步架构，能以极少的资源处理海量并发连接，以<strong>高性能、高稳定性和低内存占用</strong>著称。</p><p><strong>应用场景</strong></p><table><thead><tr><th style="text-align:left;">场景</th><th style="text-align:left;">角色</th><th style="text-align:left;">核心作用</th><th style="text-align:left;">简单比喻</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>静态内容服务</strong></td><td style="text-align:left;">Web 服务器</td><td style="text-align:left;">直接高效地处理静态文件（HTML, CSS, 图片等）</td><td style="text-align:left;"><strong>仓库管理员</strong>，直接发货</td></tr><tr><td style="text-align:left;"><strong>反向代理</strong></td><td style="text-align:left;">流量门户</td><td style="text-align:left;">接收所有用户请求，转发给后端应用服务器，并隐藏服务器细节</td><td style="text-align:left;"><strong>公司前台/总机</strong>，接收所有电话再转接内部</td></tr><tr><td style="text-align:left;"><strong>负载均衡</strong></td><td style="text-align:left;">流量分配器</td><td style="text-align:left;">将用户请求分发到多个后端服务器，提升系统性能和可用性</td><td style="text-align:left;"><strong>银行的排队叫号系统</strong>，将顾客平均分给多个柜台</td></tr></tbody></table><h2 id="【中等】什么是正向代理和反向代理" tabindex="-1"><a class="header-anchor" href="#【中等】什么是正向代理和反向代理"><span>【中等】什么是正向代理和反向代理？</span></a></h2><p>反向代理（Reverse Proxy）方式是指以代理服务器来接受 internet 上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 internet 上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/web/nginx/reverse-proxy.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="【中等】如何用-nginx-做限流-有几种限流算法-分别如何实现" tabindex="-1"><a class="header-anchor" href="#【中等】如何用-nginx-做限流-有几种限流算法-分别如何实现"><span>【中等】如何用 Nginx 做限流，有几种限流算法，分别如何实现？</span></a></h2><p>Nginx 主要通过两个<strong>原生模块</strong>实现限流，对应两种不同的场景：</p><p>（1）<strong><code>limit_req_zone</code> / <code>limit_req</code>：限制请求速率（常用）</strong></p><ul><li><strong>算法</strong>：<strong>漏桶算法</strong>，能<strong>平滑突发流量</strong>，强制以恒定速率处理请求。</li><li><strong>目的</strong>：防止 CC 攻击、API 滥用、保护登录接口等。</li><li><strong>关键参数</strong>： <ul><li><code>zone</code>：定义共享内存区（存储访问状态）。</li><li><code>rate</code>：限制速率，如 <code>1r/s</code>（每秒 1 次请求）。</li><li><code>burst</code>：桶容量，允许的突发请求数（队列长度）。</li><li><code>nodelay</code>：与 <code>burst</code> 联用，立即处理突发队列中的请求，不延迟。</li></ul></li></ul><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-nginx"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># http 块中定义限流规则</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 定义规则：以客户端 IP 为键，速率限制为每秒 10 次请求</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    limit_req_zone </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">binary_remote_addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> zone=my_rate_limit:10m rate=10r/s;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># server/location 块中应用规则</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /api/ {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 应用规则，并允许最多 20 个请求的突发队列，且立即处理</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        limit_req </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">zone=my_rate_limit burst=20 nodelay;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）<strong><code>limit_conn_zone</code> / <code>limit_conn</code>：限制并发连接数</strong></p><ul><li><strong>算法</strong>：无特定算法，简单计数。</li><li><strong>目的</strong>：防止单个客户端（如 IP）建立过多连接，耗尽服务器资源。适用于下载、上传等场景。</li><li><strong>关键参数</strong>： <ul><li><code>zone</code>：定义共享内存区。</li><li>数值：每个键（如 IP）允许的最大并发连接数。</li></ul></li></ul><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-nginx"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># http 块中定义</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 定义连接限制区</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    limit_conn_zone </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">binary_remote_addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> zone=my_conn_limit:10m;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># server/location 块中应用</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /download/ {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 每个 IP 同时只能有 2 个连接</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        limit_conn </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">my_conn_limit </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 可配合限速</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        limit_rate </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">500k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>其他限流算法对比</strong></p><table><thead><tr><th style="text-align:left;">算法</th><th style="text-align:left;">特点</th><th style="text-align:left;">Nginx 支持情况</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>漏桶算法</strong></td><td style="text-align:left;"><strong>平滑流量</strong>，输出速率恒定，Nginx 原生支持。</td><td style="text-align:left;"><strong>原生支持</strong> (<code>limit_req</code>)</td></tr><tr><td style="text-align:left;"><strong>令牌桶算法</strong></td><td style="text-align:left;"><strong>允许突发</strong>，只要桶里有令牌即可快速处理。</td><td style="text-align:left;">需通过 OpenResty/Lua 等扩展实现</td></tr><tr><td style="text-align:left;"><strong>滑动窗口</strong></td><td style="text-align:left;"><strong>更精确</strong>，解决临界点问题，适合分布式环境。</td><td style="text-align:left;">需通过 OpenResty/Lua+Redis 等扩展实现</td></tr></tbody></table><p><strong>建议</strong></p><ul><li><strong>首选 <code>limit_req</code></strong>：应对大多数流量控制场景。</li><li><strong>善用 <code>burst</code> 和 <code>nodelay</code></strong>：在限制速率的同时，兼顾用户体验，允许合理的突发流量。</li><li><strong>组合使用</strong>：对核心接口可同时使用 <code>limit_req</code>（防刷）和 <code>limit_conn</code>（防资源耗尽）。</li><li><strong>设置白名单</strong>：避免内部 IP 或健康检查被误限。</li></ul><h2 id="【中等】如何用-nginx-实现反向代理" tabindex="-1"><a class="header-anchor" href="#【中等】如何用-nginx-实现反向代理"><span>【中等】如何用 Nginx 实现反向代理？</span></a></h2><p>要使用 Nginx 实现反向代理，你需要配置 Nginx 的配置文件，指定代理规则。以下是具体步骤和示例：</p><p>基本反向代理配置</p><p>打开 Nginx 配置文件（通常位于 <code>/etc/nginx/nginx.conf</code> 或 <code>/etc/nginx/conf.d/default.conf</code>），添加如下配置：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-nginx"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;                 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Nginx 监听的端口</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">example.com;   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 访问的域名</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 反向代理配置</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_pass </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">http://127.0.0.1:3000;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 目标服务器地址（被代理的服务）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_set_header </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Host $</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 传递主机名</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_set_header </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">X-Real-IP $</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">remote_addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 传递真实客户端 IP</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_set_header </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">X-Forwarded-For $</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">proxy_add_x_forwarded_for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 传递代理链 IP</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_set_header </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">X-Forwarded-Proto $</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">scheme</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 传递协议（http/https）</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>按路径分流的反向代理</strong></p><p>可以根据不同的 URL 路径代理到不同的服务：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-nginx"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">example.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 访问 /api 路径时代理到后端 API 服务</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /api {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_pass </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">http://127.0.0.1:8080;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_set_header </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Host $</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 其他代理头配置。..</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 访问 /admin 路径时代理到管理后台服务</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /admin {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_pass </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">http://127.0.0.1:9000;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_set_header </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Host $</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 其他代理头配置。..</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 其他路径代理到前端服务</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_pass </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">http://127.0.0.1:3000;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_set_header </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Host $</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 其他代理头配置。..</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>检查并生效配置</strong></p><p>配置完成后，执行以下命令检查配置是否正确并重启 Nginx：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 检查配置语法</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重启 Nginx 使配置生效</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 或</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>核心参数</strong></p><ul><li><code>proxy_pass</code>：指定被代理的目标服务器地址（可以是 IP: 端口 或域名）</li><li><code>proxy_set_header</code>：设置传递给后端服务器的请求头</li><li><code>listen</code>：Nginx 监听的端口</li><li><code>server_name</code>：匹配的域名</li></ul><h2 id="【中等】如何用-nginx-实现负载均衡" tabindex="-1"><a class="header-anchor" href="#【中等】如何用-nginx-实现负载均衡"><span>【中等】如何用 Nginx 实现负载均衡？</span></a></h2><p>要使用 Nginx 实现负载均衡，需要在配置中定义一个后端服务器集群（upstream），然后通过反向代理将请求分发到集群中的服务器。以下是具体实现方法：</p><p><strong>基本负载均衡配置</strong></p><p>首先定义一个服务器集群，然后配置反向代理指向这个集群：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-nginx"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 定义后端服务器集群</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> backend_servers {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:3000;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 服务器 1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:3001;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 服务器 2</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 192.168.1.100:3000;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 服务器 3（可跨主机）</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置反向代理到集群</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">example.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_pass </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">http://backend_servers;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 指向上面定义的集群</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_set_header </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Host $</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        proxy_set_header </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">X-Real-IP $</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">remote_addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>负载均衡策略</strong></p><p>Nginx 提供了多种负载均衡策略，默认是<strong>轮询</strong>（每个请求按顺序分配到不同服务器），其他常用策略如下：</p>`,49)),d(h,{data:[{id:"权重分配（weight）"},{id:"IP 哈希（ip_hash）"},{id:"最少连接（least_conn）"},{id:"URL 哈希（需要第三方模块）"}],"tab-id":"负载均衡配置"},{title0:a(({value:l,isActive:e})=>[...n[0]||(n[0]=[s("权重分配（weight）",-1)])]),title1:a(({value:l,isActive:e})=>[...n[1]||(n[1]=[s("IP 哈希（ip_hash）",-1)])]),title2:a(({value:l,isActive:e})=>[...n[2]||(n[2]=[s("最少连接（least_conn）",-1)])]),title3:a(({value:l,isActive:e})=>[...n[3]||(n[3]=[s("URL 哈希（需要第三方模块）",-1)])]),tab0:a(({value:l,isActive:e})=>[...n[4]||(n[4]=[i("p",null,"给性能更好的服务器分配更高权重：",-1),i("div",{class:"language-nginx line-numbers-mode","data-highlighter":"shiki","data-ext":"nginx",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-nginx"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"upstream"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," backend_servers {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"    server"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," 127.0.0.1:3000 "),i("span",{style:{"--shiki-light":"#383A42","--shiki-light-font-style":"inherit","--shiki-dark":"#E06C75","--shiki-dark-font-style":"italic"}},"weight"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"="),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"3"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},";  "),i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 30%的请求")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"    server 127.0.0.1:3001 "),i("span",{style:{"--shiki-light":"#383A42","--shiki-light-font-style":"inherit","--shiki-dark":"#E06C75","--shiki-dark-font-style":"italic"}},"weight"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"="),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"2"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},";  "),i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 20%的请求")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"    server 192.168.1.100:3000 "),i("span",{style:{"--shiki-light":"#383A42","--shiki-light-font-style":"inherit","--shiki-dark":"#E06C75","--shiki-dark-font-style":"italic"}},"weight"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"="),i("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"5"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},";  "),i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 50%的请求")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"}")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1)])]),tab1:a(({value:l,isActive:e})=>[...n[5]||(n[5]=[i("p",null,"同一客户端 IP 始终访问同一服务器（解决会话保持问题）：",-1),i("div",{class:"language-nginx line-numbers-mode","data-highlighter":"shiki","data-ext":"nginx",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-nginx"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"upstream"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," backend_servers {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"    ip_hash"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},";  "),i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 启用 IP 哈希策略")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"    server"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," 127.0.0.1:3000;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"    server"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," 127.0.0.1:3001;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"}")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1)])]),tab2:a(({value:l,isActive:e})=>[...n[6]||(n[6]=[i("p",null,"优先分配请求到连接数最少的服务器：",-1),i("div",{class:"language-nginx line-numbers-mode","data-highlighter":"shiki","data-ext":"nginx",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-nginx"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"upstream"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," backend_servers {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"    least_conn"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},";  "),i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 启用最少连接策略")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"    server"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," 127.0.0.1:3000;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"    server"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," 127.0.0.1:3001;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"}")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1)])]),tab3:a(({value:l,isActive:e})=>[...n[7]||(n[7]=[i("p",null,[s("根据请求 URL 分配到固定服务器（需安装 "),i("code",null,"ngx_http_upstream_hash_module"),s("）：")],-1),i("div",{class:"language-nginx line-numbers-mode","data-highlighter":"shiki","data-ext":"nginx",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[i("code",{class:"language-nginx"},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"upstream"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," backend_servers {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"    hash "),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"$"),i("span",{style:{"--shiki-light":"#E45649","--shiki-dark":"#E06C75"}},"request_uri"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},";  "),i("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 按 URL 哈希")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"    server"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," 127.0.0.1:3000;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A626A4","--shiki-dark":"#C678DD"}},"    server"),i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," 127.0.0.1:3001;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"}")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1)])]),_:1}),n[9]||(n[9]=t(`<p><strong>高级配置（健康检查）</strong></p><p>配置服务器健康检查，自动剔除故障节点：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-nginx"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> backend_servers {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:3000;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 127.0.0.1:3001;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 健康检查配置</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    keepalive </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 保持连接数</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    max_fails</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 最大失败次数</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    fail_timeout</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 失败后暂停 30 秒</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>配置生效</strong></p><p>完成配置后，检查并重启 Nginx：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 检查配置语法</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重启 Nginx</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 或</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过以上配置，Nginx 会根据指定策略将请求分发到后端服务器集群，实现负载均衡，提高系统可用性和吞吐量。</p>`,7))])}const B=k(c,[["render",o]]),m=JSON.parse('{"path":"/pages/73ef7196/","title":"Nginx 面试","lang":"zh-CN","frontmatter":{"icon":"logos:nginx","title":"Nginx 面试","date":"2025-09-25T07:49:46.000Z","order":99,"categories":["DevOps","工具","Nginx"],"tags":["DevOps","Nginx","面试"],"permalink":"/pages/73ef7196/","description":"Nginx 面试 【中等】如何限制上传文件大小？ 显示错误信息：413 Request Entity Too Large。 意思是请求的内容过大，浏览器不能正确显示。常见的情况是发送 POST 请求来上传大文件。 解决方法 可以在 http 模块中设置：client_max_body_size 20m; 可以在 server 模块中设置：client_...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Nginx 面试\\",\\"image\\":[\\"https://raw.githubusercontent.com/dunwu/images/master/cs/web/nginx/nginx.jpg\\",\\"https://raw.githubusercontent.com/dunwu/images/master/cs/web/nginx/reverse-proxy.png\\"],\\"datePublished\\":\\"2025-09-25T07:49:46.000Z\\",\\"dateModified\\":\\"2026-02-08T14:32:09.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"钝悟\\",\\"url\\":\\"https://dunwu.github.io/waterdrop\\"}]}"],["meta",{"property":"og:url","content":"https://dunwu.github.io/waterdrop/waterdrop/pages/73ef7196/"}],["meta",{"property":"og:site_name","content":"钝悟"}],["meta",{"property":"og:title","content":"Nginx 面试"}],["meta",{"property":"og:description","content":"Nginx 面试 【中等】如何限制上传文件大小？ 显示错误信息：413 Request Entity Too Large。 意思是请求的内容过大，浏览器不能正确显示。常见的情况是发送 POST 请求来上传大文件。 解决方法 可以在 http 模块中设置：client_max_body_size 20m; 可以在 server 模块中设置：client_..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/dunwu/images/master/cs/web/nginx/nginx.jpg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-02-08T14:32:09.000Z"}],["meta",{"property":"article:tag","content":"面试"}],["meta",{"property":"article:tag","content":"Nginx"}],["meta",{"property":"article:tag","content":"DevOps"}],["meta",{"property":"article:published_time","content":"2025-09-25T07:49:46.000Z"}],["meta",{"property":"article:modified_time","content":"2026-02-08T14:32:09.000Z"}]]},"git":{"createdTime":1758757939000,"updatedTime":1770561129000,"contributors":[{"name":"dunwu","username":"dunwu","email":"forbreak@163.com","commits":2,"url":"https://github.com/dunwu"}]},"readingTime":{"minutes":6.96,"words":2089},"filePathRelative":"04.DevOps/工具/Nginx/Nginx_面试.md","excerpt":"\\n<h2>【中等】如何限制上传文件大小？</h2>\\n<p>显示错误信息：<strong>413 Request Entity Too Large</strong>。</p>\\n<p>意思是请求的内容过大，浏览器不能正确显示。常见的情况是发送 <code>POST</code> 请求来上传大文件。</p>\\n<p><strong>解决方法</strong></p>\\n<ul>\\n<li>可以在 <code>http</code> 模块中设置：<code>client_max_body_size  20m;</code></li>\\n<li>可以在 <code>server</code> 模块中设置：<code>client_max_body_size  20m;</code></li>\\n<li>可以在 <code>location</code> 模块中设置：<code>client_max_body_size  20m;</code></li>\\n</ul>","autoDesc":true}');export{B as comp,m as data};
